// Hoodie.js - 1.0.3
// https://github.com/hoodiehq/hoodie.js
// Copyright 2012 - 2014 https://github.com/hoodiehq/
// Licensed Apache License 2.0

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Hoodie=a()}}(function(){var a,b,c;return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=b[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,d,a,b,c)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b){"use strict";b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return d.isRejected()?d:(b.setHowMany(1),b.setUnwrap(),b.init(),d)}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],2:[function(a,b){(function(c){"use strict";function d(){this._isTickUsed=!1,this._lateQueue=new h(16),this._normalQueue=new h(16);var a=this;this.drainQueues=function(){a._drainQueues()},this._schedule=g.isStatic?g(this.drainQueues):g}var e;try{throw new Error}catch(f){e=f}var g=a("./schedule.js"),h=a("./queue.js"),i="undefined"!=typeof c?c:void 0;d.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},d.prototype._withDomain=function(a){return void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a)),a},d.prototype.throwLater=function(a,b){if(1===arguments.length&&(b=a,a=function(){throw b}),a=this._withDomain(a),"undefined"!=typeof setTimeout)setTimeout(function(){a(b)},0);else try{this._schedule(function(){a(b)})}catch(c){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},d.prototype.invokeLater=function(a,b,c){a=this._withDomain(a),this._lateQueue.push(a,b,c),this._queueTick()},d.prototype.invokeFirst=function(a,b,c){a=this._withDomain(a),this._normalQueue.unshift(a,b,c),this._queueTick()},d.prototype.invoke=function(a,b,c){a=this._withDomain(a),this._normalQueue.push(a,b,c),this._queueTick()},d.prototype.settlePromises=function(a){this._normalQueue._pushOne(a),this._queueTick()},d.prototype._drainQueue=function(a){for(;a.length()>0;){var b=a.shift();if("function"==typeof b){var c=a.shift(),d=a.shift();b.call(c,d)}else b._settlePromises()}},d.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},d.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},d.prototype._reset=function(){this._isTickUsed=!1},b.exports=new d,b.exports.firstLineError=e}).call(this,a("FWaASH"))},{"./queue.js":24,"./schedule.js":27,FWaASH:36}],3:[function(a,b){"use strict";function c(){try{Promise===e&&(Promise=d)}catch(a){}return e}var d;"undefined"!=typeof Promise&&(d=Promise);var e=a("./promise.js")();e.noConflict=c,b.exports=e},{"./promise.js":19}],4:[function(a,b){"use strict";var c=Object.create;if(c){var d=c(null),e=c(null);d[" size"]=e[" size"]=0}b.exports=function(b){function c(a){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,a))}function f(a){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",a))}function g(a,b,c){var d=c[a];if("function"!=typeof d){if(!o(a))return null;if(d=b(a),c[a]=d,c[" size"]++,c[" size"]>512){for(var e=Object.keys(c),f=0;256>f;++f)delete c[e[f]];c[" size"]=e.length-256}}return d}function h(a){return g(a,c,d)}function i(a){return g(a,f,e)}function j(a){return a[this.pop()].apply(a,this)}function k(a){return a[this]}function l(a){var b=+this;return 0>b&&(b=Math.max(0,b+a.length)),a[b]}var m=a("./util.js"),n=m.canEvaluate,o=m.isIdentifier;b.prototype.call=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;++d)c[d-1]=arguments[d];if(n){var e=h(a);if(null!==e)return this._then(e,void 0,void 0,c,void 0)}return c.push(a),this._then(j,void 0,void 0,c,void 0)},b.prototype.get=function(a){var b,c="number"==typeof a;if(c)b=l;else if(n){var d=i(a);b=null!==d?d:k}else b=k;return this._then(b,void 0,void 0,a,void 0)}}},{"./util.js":34}],5:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./errors.js"),e=a("./async.js"),f=d.CancellationError;b.prototype._cancel=function(a){if(!this.isCancellable())return this;for(var b,c=this;void 0!==(b=c._cancellationParent)&&b.isCancellable();)c=b;this._unsetCancellable(),c._target()._rejectCallback(a,!1,!0)},b.prototype.cancel=function(a){return this.isCancellable()?(void 0===a&&(a=new f),e.invokeLater(this._cancel,this,a),this):this},b.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},b.prototype.uncancellable=function(){var a=new b(c);return a._propagateFrom(this,4),a._follow(this),a._unsetCancellable(),a},b.prototype.fork=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);return d._setCancellable(),d._cancellationParent=void 0,d}}},{"./async.js":2,"./errors.js":10}],6:[function(a,b){(function(c){"use strict";b.exports=function(){function b(a){this._parent=a;var c=this._length=1+(void 0===a?0:a._length);u(this,b),c>32&&this.uncycle()}function d(a,b){for(var c=0;c<b.length-1;++c)b[c].push("From previous event:"),b[c]=b[c].join("\n");return b[c]=b[c].join("\n"),a+"\n"+b.join("\n")}function e(a){for(var b=0;b<a.length;++b)(0===a[b].length||b+1<a.length&&a[b][0]===a[b+1][0])&&(a.splice(b,1),b--)}function f(a){for(var b=a[0],c=1;c<a.length;++c){for(var d=a[c],e=b.length-1,f=b[e],g=-1,h=d.length-1;h>=0;--h)if(d[h]===f){g=h;break}for(var h=g;h>=0;--h){var i=d[h];if(b[e]!==i)break;b.pop(),e--}b=d}}function g(a){for(var b=0;b<a.length;++b){var c=a[b];if("    (No stack trace)"===c||p.test(c))break}if(1>=b)return 1;for(var d=[],e=0;b>e;++e)d.push(a.shift());return a.unshift(d.join("\x00")),b}function h(a){return a.length>0&&(a[0]=a[0].split("\x00").join("\n")),a}function i(a,b){for(var c=a.slice(0,b),d=b;d<a.length;++d){var e=a[d],f=p.test(e)||"    (No stack trace)"===e,g=f&&r(e);f&&!g&&c.push(e)}return c}function j(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var c=/\[object [a-zA-Z0-9$_]+\]/;if(c.test(b))try{var d=JSON.stringify(a);b=d}catch(e){}0===b.length&&(b="(empty array)")}return"(<"+k(b)+">, no stack trace)"}function k(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function l(a){var b=a.match(s);return b?{fileName:b[1],line:parseInt(b[2],10)}:void 0}var m=a("./async.js"),n=a("./util.js").inherits,o=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo)/,p=null,q=null;n(b,Error),b.prototype.uncycle=function(){var a=this._length;if(!(2>a)){for(var b=[],c={},d=0,e=this;void 0!==e;++d)b.push(e),e=e._parent;a=this._length=d;for(var d=a-1;d>=0;--d){var f=b[d].stack;void 0===c[f]&&(c[f]=d)}for(var d=0;a>d;++d){var g=b[d].stack,h=c[g];if(void 0!==h&&h!==d){h>0&&(b[h-1]._parent=void 0,b[h-1]._length=1),b[d]._parent=void 0,b[d]._length=1;var i=d>0?b[d-1]:this;a-1>h?(i._parent=b[h+1],i._parent.uncycle(),i._length=i._parent._length+1):(i._parent=void 0,i._length=1);for(var j=i._length+1,k=d-2;k>=0;--k)b[k]._length=j,j++;return}}}},b.prototype.parent=function(){return this._parent},b.prototype.hasParent=function(){return void 0!==this._parent},b.prototype.attachExtraTrace=function(a){if(!a.__stackCleaned__){this.uncycle();for(var c=b.cleanHeaderStack(a,!1),g=[c.slice(1)],h=this;void 0!==h;)g.push(i(h.stack.split("\n"),0)),h=h._parent;f(g),e(g);var j=c[0].split("\x00").join("\n");a.stack=d(j,g)}},b.cleanHeaderStack=function(a,b){if(!a.__stackCleaned__){a.__stackCleaned__=!0;var c=a.stack;c="string"==typeof c?c.split("\n"):[a.toString(),"    (No stack trace)"];var d=g(c);return c=i(c,d),b&&(c=h(c)),a.stack=c.join("\n"),c}},b.formatAndLogError=function(a,b){if("object"==typeof console){var c;if("object"==typeof a||"function"==typeof a){var d=a.stack;c=b+q(d,a)}else c=b+String(a);"function"==typeof console.warn||"object"==typeof console.warn?console.warn(c):("function"==typeof console.log||"object"==typeof console.log)&&console.log(c)}},b.unhandledRejection=function(a){b.formatAndLogError(a,"^--- With additional stack trace: ")},b.isSupported=function(){return"function"==typeof u},b.fireRejectionEvent=function(a,c,d,e){var f=!1;try{"function"==typeof c&&(f=!0,"rejectionHandled"===a?c(e):c(d,e))}catch(g){m.throwLater(g)}var h=!1;try{h=v(a,d,e)}catch(g){h=!0,m.throwLater(g)}var i=!1;if(t)try{i=t(a.toLowerCase(),{reason:d,promise:e})}catch(g){i=!0,m.throwLater(g)}h||f||i||"unhandledRejection"!==a||b.formatAndLogError(d,"Possibly unhandled ")};var r=function(){return!1},s=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;b.setBounds=function(a,c){if(b.isSupported()){for(var d,e,f=a.stack.split("\n"),g=c.stack.split("\n"),h=-1,i=-1,j=0;j<f.length;++j){var k=l(f[j]);if(k){d=k.fileName,h=k.line;break}}for(var j=0;j<g.length;++j){var k=l(g[j]);if(k){e=k.fileName,i=k.line;break}}0>h||0>i||!d||!e||d!==e||h>=i||(r=function(a){if(o.test(a))return!0;var b=l(a);return b&&b.fileName===d&&h<=b.line&&b.line<=i?!0:!1})}};var t,u=function w(){var a=/^\s*at\s*/,b=function(a,b){return"string"==typeof a?a:void 0!==b.name&&void 0!==b.message?b.name+". "+b.message:j(b)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,p=a,q=b;var c=Error.captureStackTrace;return r=function(a){return o.test(a)},function(a,b){Error.stackTraceLimit=Error.stackTraceLimit+6,c(a,b),Error.stackTraceLimit=Error.stackTraceLimit-6}}var d=new Error;if("string"==typeof d.stack&&"function"==typeof"".startsWith&&d.stack.startsWith("stackDetection@")&&"stackDetection"===w.name){p=/@/;var e=/[@\n]/;return q=function(a,b){return"string"==typeof a?b.name+". "+b.message+"\n"+a:void 0!==b.name&&void 0!==b.message?b.name+". "+b.message:j(b)},function(a){for(var b=(new Error).stack,c=b.split(e),d=c.length,f="",g=0;d>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}var f;try{throw new Error}catch(g){f="stack"in g}return"stack"in d||!f?(q=function(a,b){return"string"==typeof a?a:"object"!=typeof b&&"function"!=typeof b||void 0===b.name||void 0===b.message?j(b):b.name+". "+b.message},null):(p=a,q=b,function(a){try{throw new Error}catch(b){a.stack=b.stack}})}(),v=function(){if("undefined"!=typeof c&&"string"==typeof c.version&&"undefined"==typeof window)return function(a,b,d){return"rejectionHandled"===a?c.emit(a,d):c.emit(a,b,d)};var a=!1;try{var b=new self.CustomEvent("test");a=b instanceof CustomEvent}catch(d){}t=function(b,c){var d;return a?d=new self.CustomEvent(b,{detail:c,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!1,!0,c)),d?!self.dispatchEvent(d):!1};var e={};return e.unhandledRejection="onunhandledRejection".toLowerCase(),e.rejectionHandled="onrejectionHandled".toLowerCase(),function(a,b,c){var d=e[a],f=self[d];return f?("rejectionHandled"===a?f.call(self,c):f.call(self,b,c),!0):!1}}();return b}}).call(this,a("FWaASH"))},{"./async.js":2,"./util.js":34,FWaASH:36}],7:[function(a,b){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a).call(c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,e=this._promise,f=e._boundTo,i=0,j=this._instances.length;j>i;++i){var k=this._instances[i],l=k===Error||null!=k&&k.prototype instanceof Error;if(l&&a instanceof k){var m=g(c).call(f,a);return m===h?(b.e=m.e,b):m}if("function"==typeof k&&!l){var n=d(k,a);if(n===h){a=h.e;break}if(n){var m=g(c).call(f,a);return m===h?(b.e=m.e,b):m}}}return b.e=a,b},c}},{"./errors.js":10,"./es5.js":11,"./util.js":34}],8:[function(a,b){"use strict";var c=a("./util.js"),d=c.isPrimitive,e=c.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},f=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype["return"]=a.prototype.thenReturn=function(a){return e&&d(a)?this._then(f(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return e&&d(a)?this._then(f(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":34}],9:[function(a,b){"use strict";b.exports=function(a,b){var c=a.reduce;a.prototype.each=function(a){return c(this,a,null,b)},a.each=function(a,d){return c(a,d,null,b)}}},{}],10:[function(a,b){"use strict";function c(a,b){function c(d){return this instanceof c?(j(this,"message","string"==typeof d?d:b),j(this,"name",a),void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new c(d)}return i(c,Error),c}function d(a){j(this,"name","OperationalError"),j(this,"message",a),this.cause=a,this.isOperational=!0,a instanceof Error?(j(this,"message",a.message),j(this,"stack",a.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var e,f,g=a("./es5.js").freeze,h=a("./util.js"),i=h.inherits,j=h.notEnumerableProp,k=c("CancellationError","cancellation error"),l=c("TimeoutError","timeout error"),m=c("AggregateError","aggregate error");try{e=TypeError,f=RangeError}catch(n){e=c("TypeError","type error"),f=c("RangeError","range error")}for(var o="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),p=0;p<o.length;++p)"function"==typeof Array.prototype[o[p]]&&(m.prototype[o[p]]=Array.prototype[o[p]]);m.prototype.length=0,m.prototype.isOperational=!0;var q=0;m.prototype.toString=function(){var a=Array(4*q+1).join(" "),b="\n"+a+"AggregateError of:\n";q++,a=Array(4*q+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return q--,b},i(d,Error);var r=Error.__BluebirdErrorTypes__;r||(r=g({CancellationError:k,TimeoutError:l,OperationalError:d,RejectionError:d,AggregateError:m}),j(Error,"__BluebirdErrorTypes__",r)),b.exports={Error:Error,TypeError:e,RangeError:f,CancellationError:r.CancellationError,OperationalError:r.OperationalError,TimeoutError:r.TimeoutError,AggregateError:r.AggregateError}},{"./es5.js":11,"./util.js":34}],11:[function(a,b){var c=function(){"use strict";return void 0===this}();if(c)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:c,propertyIsWritable:function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return!(c&&!c.writable&&!c.set)}};else{var d={}.hasOwnProperty,e={}.toString,f={}.constructor.prototype,g=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},h=function(a,b,c){return a[b]=c.value,a},i=function(a){return a},j=function(a){try{return Object(a).constructor.prototype}catch(b){return f}},k=function(a){try{return"[object Array]"===e.call(a)}catch(b){return!1}};b.exports={isArray:k,keys:g,defineProperty:h,freeze:i,getPrototypeOf:j,isES5:c,propertyIsWritable:function(){return!0}}}},{}],12:[function(a,b){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],13:[function(a,b){"use strict";b.exports=function(b,c,d){function e(){return this}function f(){throw this}function g(a){return function(){return a}}function h(a){return function(){throw a}}function i(a,b,c){var d;return d=m&&n(b)?c?g(b):h(b):c?e:f,a._then(d,o,void 0,b,void 0)}function j(a){var e=this.promise,f=this.handler,g=e._isBound()?f.call(e._boundTo):f();if(void 0!==g){var h=d(g,e);if(h instanceof b)return h=h._target(),i(h,a,e.isFulfilled())}return e.isRejected()?(c.e=a,c):a}function k(a){var c=this.promise,e=this.handler,f=c._isBound()?e.call(c._boundTo,a):e(a);if(void 0!==f){var g=d(f,c);if(g instanceof b)return g=g._target(),i(g,a,!0)}return a}var l=a("./util.js"),m=l.wrapsPrimitiveReceiver,n=l.isPrimitive,o=l.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?j:k,b?j:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":34}],14:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,c,d){for(var f=0;f<c.length;++f){d._pushContext();var g=m(c[f])(a);if(d._popContext(),g===l){d._pushContext();var h=b.reject(l.e);return d._popContext(),h}var i=e(g,d);if(i instanceof b)return i}return null}function g(a,c,e,f){var g=this._promise=new b(d);g._captureStackTrace(),this._stack=f,this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(n):n}var h=a("./errors.js"),i=h.TypeError,j=a("./util.js").deprecated,k=a("./util.js"),l=k.errorObj,m=k.tryCatch,n=[];g.prototype.promise=function(){return this._promise},g.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},g.prototype._continue=function(a){if(a===l){this._generator=void 0;var c=k.canAttachTrace(a.e)?a.e:new Error(k.toString(a.e));return this._promise._attachExtraTrace(c),void this._promise._reject(a.e,c)}var d=a.value;if(a.done===!0)this._generator=void 0,this._promise._tryFollow(d)||this._promise._fulfill(d);else{var g=e(d,this._promise);if(!(g instanceof b)&&(g=f(g,this._yieldHandlers,this._promise),null===g))return void this._throw(new i("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",d)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));g._then(this._next,this._throw,void 0,this,null)}},g.prototype._throw=function(a){k.canAttachTrace(a)&&this._promise._attachExtraTrace(a),this._promise._pushContext();var b=m(this._generator["throw"]).call(this._generator,a);this._promise._popContext(),this._continue(b)},g.prototype._next=function(a){this._promise._pushContext();var b=m(this._generator.next).call(this._generator,a);this._promise._popContext(),this._continue(b)},b.coroutine=function(a,b){if("function"!=typeof a)throw new i("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var c=Object(b).yieldHandler,d=g,e=(new Error).stack;return function(){var b=a.apply(this,arguments),f=new d(void 0,void 0,c,e);return f._generator=b,f._next(void 0),f.promise()}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new i("fn must be a function\n\n    See http://goo.gl/916lJJ\n");n.push(a)},b.spawn=function(a){if(j("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof a)return c("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var d=new g(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors.js":10,"./util.js":34}],15:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){this._reject(a)}var g=a("./util.js"),h=g.canEvaluate,i=g.tryCatch,j=g.errorObj;if(h){for(var k=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},l=function(a){for(var b=[],c=1;a>=c;++c)b.push("holder.p"+c);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,b.join(", ")))},m=[],n=[void 0],o=1;5>=o;++o)m.push(k(o)),n.push(l(o));var p=function(a,b){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=b,this.total=a,this.now=0};p.prototype.callers=n,p.prototype.checkFulfillment=function(a){var b=this.now;b++;var c=this.total;if(b>=c){var d=this.callers[c];a._pushContext();var e=i(d)(this);a._popContext(),e===j?a._rejectCallback(e.e,!1,!0):a._tryFollow(e)||a._fulfillUnchecked(e)}else this.now=b}}b.join=function(){var a,g=arguments.length-1;if(g>0&&"function"==typeof arguments[g]&&(a=arguments[g],6>g&&h)){var i=new b(e);i._captureStackTrace();for(var j=new p(g,a),k=m,l=0;g>l;++l){var n=d(arguments[l],i);n instanceof b?(n=n._target(),n._isPending()?n._then(k[l],f,void 0,i,j):n._isFulfilled()?k[l].call(i,n._value(),j):i._reject(n._reason())):k[l].call(i,n,j)}return i}for(var o=arguments.length,q=new Array(o),r=0;o>r;++r)q[r]=arguments[r];var i=new c(q).promise();return void 0!==a?i.spread(a):i}}},{"./util.js":34}],16:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,b,c,d){this.constructor$(a),this._promise._setIsSpreadable(),this._promise._captureStackTrace(),this._callback=b,this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=c>=1?[]:m,this._init$(void 0,-2)}function h(a,b,c,d){var e="object"==typeof c&&null!==c?c.concurrency:0;return e="number"==typeof e&&isFinite(e)&&e>=1?e:0,new g(a,b,e,d)}var i=a("./util.js"),j=i.tryCatch,k=i.errorObj,l={},m=[];i.inherits(g,c),g.prototype._init=function(){},g.prototype._promiseFulfilled=function(a,c){var d=this._values,f=this.length(),g=this._preservedValues,h=this._limit;if(d[c]===l){if(d[c]=a,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(h>=1&&this._inFlight>=h)return d[c]=a,void this._queue.push(c);null!==g&&(g[c]=a);var i=this._callback,m=this._promise._boundTo;this._promise._pushContext();var n=j(i).call(m,a,c,f);if(this._promise._popContext(),n===k)return this._reject(n.e);var o=e(n,this._promise);if(o instanceof b){if(o=o._target(),o._isPending())return h>=1&&this._inFlight++,d[c]=l,o._proxyPromiseArray(this,c);if(!o._isFulfilled())return this._reject(o._reason());n=o._value()}d[c]=n}var p=++this._totalResolved;p>=f&&(null!==g?this._filter(d,g):this._resolve(d))},g.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){if(this._isResolved())return;var d=a.pop();this._promiseFulfilled(c[d],d)}},g.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;c>f;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},g.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return"function"!=typeof a?d("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):h(this,a,b,null).promise()},b.map=function(a,b,c,e){return"function"!=typeof b?d("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):h(a,b,c,e).promise()}}},{"./util.js":34}],17:[function(a,b){"use strict";b.exports=function(b){function c(a,b){var c=this;if(!f.isArray(a))return d.call(c,a,b);var e=h(b).apply(c._boundTo,[null].concat(a));e===i&&g.throwLater(e.e)}function d(a,b){var c=this,d=c._boundTo,e=void 0===a?h(b).call(d,null):h(b).call(d,null,a);e===i&&g.throwLater(e.e)}function e(a,b){var c=this;if(!a){var d=c._target(),e=d._getCarriedStackTrace();e.cause=a,a=e}var f=h(b).call(c._boundTo,a);f===i&&g.throwLater(f.e)}var f=a("./util.js"),g=a("./async.js"),h=f.tryCatch,i=f.errorObj;b.prototype.nodeify=function(a,b){if("function"==typeof a){var f=d;void 0!==b&&Object(b).spread&&(f=c),this._then(f,e,void 0,this,a)}return this}}},{"./async.js":2,"./util.js":34}],18:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./util.js"),e=a("./async.js"),f=d.tryCatch,g=d.errorObj;b.prototype.progressed=function(a){return this._then(void 0,void 0,a,void 0,void 0)},b.prototype._progress=function(a){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(a)},b.prototype._progressHandlerAt=function(a){return 0===a?this._progressHandler0:this[(a<<2)+a-5+2]},b.prototype._doProgressWith=function(a){var c=a.value,e=a.handler,h=a.promise,i=a.receiver,j=f(e).call(i,c);if(j===g){if(null!=j.e&&"StopProgressPropagation"!==j.e.name){var k=d.canAttachTrace(j.e)?j.e:new Error(d.toString(j.e));h._attachExtraTrace(k),h._progress(j.e)}}else j instanceof b?j._then(h._progress,null,null,h,void 0):h._progress(j)},b.prototype._progressUnchecked=function(a){for(var d=this._length(),f=this._progress,g=0;d>g;g++){var h=this._progressHandlerAt(g),i=this._promiseAt(g);if(i instanceof b)"function"==typeof h?e.invoke(this._doProgressWith,this,{handler:h,promise:i,receiver:this._receiverAt(g),value:a}):e.invoke(f,i,a);else{var j=this._receiverAt(g);"function"==typeof h?h.call(j,a,i):j instanceof c&&!j._isResolved()&&j._promiseProgressed(a,i)}}}}},{"./async.js":2,"./util.js":34}],19:[function(a,b){(function(c){"use strict";b.exports=function(){function b(a){if("function"!=typeof a)throw new p("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==b)throw new p("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==t&&this._resolveFromResolver(a)}function d(){this._trace=new y(f())}function e(){return H?new d:void 0}function f(){var a=I.length-1;return a>=0?I[a]:void 0}var g,h,i=function(){return new p("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},j=function(){return new b.PromiseInspection(this._target())},k=function(a){return b.reject(new p(a))},l=a("./util.js"),m=a("./async.js"),n=a("./errors.js"),o=n.RangeError,p=n.TypeError,q=n.CancellationError,r=n.TimeoutError,s=n.OperationalError,t=function(){},u={},v={e:null},w=a("./thenables.js")(b,t),x=a("./promise_array.js")(b,t,w,k),y=a("./captured_trace.js")(),z=a("./catch_filter.js")(v),A=a("./promise_resolver.js"),B=l.isArray,C=l.errorObj,D=l.tryCatch,E=l.originatesFromRejection,F=l.markAsOriginatingFromRejection,G=l.canAttachTrace,H=!1||!("undefined"==typeof c||"string"!=typeof c.execPath||"object"!=typeof c.env||!c.env.BLUEBIRD_DEBUG&&"development"!==c.env.NODE_ENV);b.prototype.bind=function(a){var c=w(a),d=new b(t);d._propagateFrom(this,1);var e=this._target();return c instanceof b?(e._then(t,d._reject,d._progress,d,null),c._then(function(a){d._isPending()&&(d._setBoundTo(a),d._follow(e))},d._reject,d._progress,d,null)):(d._setBoundTo(a),d._follow(e)),d},b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype["catch"]=function(a){var c=arguments.length;if(c>1){var d,e=new Array(c-1),f=0;for(d=0;c-1>d;++d){var g=arguments[d];if("function"!=typeof g)return b.reject(new p("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));e[f++]=g}e.length=f,a=arguments[d];var h=new z(e,a,this);return this._then(void 0,h.doFilter,void 0,h,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},b.prototype.reflect=function(){return this._then(j,j,void 0,this,void 0)},b.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},b.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},b.prototype.spread=function(a,b){var c=this._target(),d=c._isSpreadable()?c===this?this:this.then():this.all();return d._then(a,b,void 0,u,void 0)},b.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},b.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},b.prototype.all=function(){var a=new x(this).promise();return a._setIsSpreadable(),a},b.prototype.error=function(a){return this.caught(E,a)},b.is=function(a){return a instanceof b},b.all=function(a){var b=new x(a).promise();return b._setIsSpreadable(),b},b.method=function(a){if("function"!=typeof a)throw new p("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var c=new b(t);c._captureStackTrace(),c._pushContext();var d=D(a).apply(this,arguments);return c._popContext(),c._resolveFromSyncValue(d),c}},b.attempt=b["try"]=function(a,c,d){if("function"!=typeof a)return k("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var e=new b(t);e._captureStackTrace(),e._pushContext();var f=B(c)?D(a).apply(d,c):D(a).call(d,c);return e._popContext(),e._resolveFromSyncValue(f),e},b.defer=b.pending=function(){var a=new b(t);return new A(a)},b.bind=function(a){var c=w(a),d=new b(t);return c instanceof b?c._then(function(a){d._setBoundTo(a),d._fulfill(void 0)},d._reject,d._progress,d,null):(d._setBoundTo(a),d._setFulfilled()),d},b.cast=function(a){var c=w(a);if(!(c instanceof b)){var d=c;c=new b(t),c._setFulfilled(),c._settledValue=d,c._cleanValues()}return c},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(a){var c=new b(t);return c._captureStackTrace(),c._rejectCallback(a,!0),c},b.onPossiblyUnhandledRejection=function(a){h="function"==typeof a?a:void 0},b.onUnhandledRejectionHandled=function(a){g="function"==typeof a?a:void 0},b.longStackTraces=function(){if(m.haveItemsQueued()&&H===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");H=y.isSupported()},b.hasLongStackTraces=function(){return H&&y.isSupported()},b.setScheduler=function(a){if("function"!=typeof a)throw new p("fn must be a function\n\n    See http://goo.gl/916lJJ\n");m._schedule=a},b.prototype._then=function(a,c,d,e,f){var g=void 0!==f,h=g?f:new b(t);g||(h._propagateFrom(this,5),h._captureStackTrace());var i=this._target();i!==this&&(void 0===e&&(e=this._boundTo),g||h._setIsMigrated());var j=i._addCallbacks(a,c,d,h,e);return i._isResolved()&&!i._isSettlePromisesQueued()&&m.invoke(i._settlePromiseAtPostResolution,i,j),h},b.prototype._settlePromiseAtPostResolution=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(a)},b.prototype._length=function(){return 131071&this._bitField},b.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},b.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},b.prototype._setLength=function(a){this._bitField=-131072&this._bitField|131071&a},b.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},b.prototype._setRejected=function(){this._bitField=134217728|this._bitField},b.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},b.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField
},b.prototype._isFinal=function(){return(33554432&this._bitField)>0},b.prototype._cancellable=function(){return(67108864&this._bitField)>0},b.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},b.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},b.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},b.prototype._isSpreadable=function(){return(131072&this._bitField)>0},b.prototype._setIsSpreadable=function(){this._bitField=131072|this._bitField},b.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},b.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},b.prototype._isMigrated=function(){return(4194304&this._bitField)>0},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},b.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=a},b.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},b.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},b.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[5*a-5+4];return this._isBound()&&void 0===b?this._boundTo:b},b.prototype._promiseAt=function(a){return 0===a?this._promise0:this[5*a-5+3]},b.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[5*a-5+0]},b.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[5*a-5+1]},b.prototype._migrateCallbacks=function(a,c,d,e,f){e instanceof b&&e._setIsMigrated(),this._addCallbacks(a,c,d,e,f)},b.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=131066&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=5*f-5;this[g+3]=d,this[g+4]=e,"function"==typeof a&&(this[g+0]=a),"function"==typeof b&&(this[g+1]=b),"function"==typeof c&&(this[g+2]=c)}return this._setLength(f+1),f},b.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=131066&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=5*c-5;this[d+3]=b,this[d+4]=a}this._setLength(c+1)},b.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},b.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},b.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},b.prototype._resolveCallback=function(a){this._tryFollow(a)||this._fulfill(a)},b.prototype._rejectCallback=function(a,b,c){c||F(a);var d=l.ensureErrorObject(a),e=G(a)&&"string"==typeof d.stack;this._attachExtraTrace(d,b?e:!1),this._reject(a,d===a?void 0:d)},b.prototype._resolveFromResolver=function(a){var b=this;this._captureStackTrace(),this._pushContext();var c=!0,d=D(a)(function(a){b._resolveCallback(a)},function(a){b._rejectCallback(a,c)});c=!1,this._popContext(),void 0!==d&&d===C&&b._rejectCallback(d.e,!0,!0)},b.prototype._settlePromiseFromHandler=function(a,b,c,d){if(!d._isRejected()){d._pushContext();var e;if(e=b!==u||this._isRejected()?D(a).call(b,c):D(a).apply(this._boundTo,c),d._popContext(),e===C||e===d||e===v){var f=e===d?i():e.e;d._rejectCallback(f,!1,!0)}else d._resolveCallback(e)}},b.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},b.prototype._followee=function(){return this._rejectionHandler0},b.prototype._setFollowee=function(a){this._rejectionHandler0=a},b.prototype._follow=function(a){if(a._isPending()){for(var b=this._length(),c=0;b>c;++c)a._migrateCallbacks(this._fulfillmentHandlerAt(c),this._rejectionHandlerAt(c),this._progressHandlerAt(c),this._promiseAt(c),this._receiverAt(c));this._setFollowing(),this._setLength(0),this._setFollowee(a),this._propagateFrom(a,1)}else a._isFulfilled()?this._fulfillUnchecked(a._value()):this._rejectUnchecked(a._reason(),a._getCarriedStackTrace());a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled()},b.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=w(a,this);return c instanceof b?(this._follow(c._target()),!0):!1},b.prototype._captureStackTrace=function(){return H&&(this._trace=new y(this._peekContext())),this},b.prototype._canAttachTrace=function(a){return H&&G(a)},b.prototype._attachExtraTraceIgnoreSelf=function(a){this._canAttachTrace(a)&&void 0!==this._trace._parent&&this._trace._parent.attachExtraTrace(a)},b.prototype._attachExtraTrace=function(a,b){if(H&&G(a)){var c=this._trace;void 0!==c&&b&&(c=c._parent),void 0!==c?c.attachExtraTrace(a):y.cleanHeaderStack(a,!0)}},b.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},b.prototype._propagateFrom=function(a,b){(1&b)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(4&b)>0&&this._setBoundTo(a._boundTo)},b.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},b.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},b.prototype._settlePromiseAt=function(a){var c=this._promiseAt(a),d=c instanceof b;if(d&&c._isMigrated())return c._unsetIsMigrated(),m.invoke(this._settlePromiseAt,this,a);var e=this._isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),f=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,g=this._settledValue,h=this._receiverAt(a);this._clearCallbackDataAtIndex(a),"function"==typeof e?d?this._settlePromiseFromHandler(e,h,g,c):e.call(h,g,c):h instanceof x?h._isResolved()||(this._isFulfilled()?h._promiseFulfilled(g,c):h._promiseRejected(g,c)):d&&(this._isFulfilled()?c._fulfill(g):c._reject(g,f)),a>=4&&4===(31&a)&&m.invokeLater(this._setLength,this,0)},b.prototype._clearCallbackDataAtIndex=function(a){if(0===a)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var b=5*a-5;this[b+3]=this[b+4]=this[b+0]=this[b+1]=this[b+2]=void 0}},b.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},b.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},b.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},b.prototype._queueSettlePromises=function(){this._isSettlePromisesQueued()||(m.settlePromises(this),this._setSettlePromisesQueued())},b.prototype._fulfillUnchecked=function(a){if(a===this){var b=i();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._setFulfilled(),this._settledValue=a,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},b.prototype._rejectUncheckedCheckError=function(a){var b=l.ensureErrorObject(a);this._rejectUnchecked(a,b===a?void 0:b)},b.prototype._rejectUnchecked=function(a,b){if(a===this){var c=i();return this._attachExtraTrace(c),this._rejectUnchecked(c)}return this._setRejected(),this._settledValue=a,this._cleanValues(),this._isFinal()?void m.throwLater(function(a){throw"stack"in a&&m.invokeFirst(y.unhandledRejection,void 0,a),a},void 0===b?a:b):(void 0!==b&&b!==a&&this._setCarriedStackTrace(b),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},b.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var a=this._length(),b=0;a>b;b++)this._settlePromiseAt(b)},b.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),m.invokeLater(this._notifyUnhandledRejection,this,void 0)},b.prototype._notifyUnhandledRejectionIsHandled=function(){y.fireRejectionEvent("rejectionHandled",g,void 0,this)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),y.fireRejectionEvent("unhandledRejection",h,a,this)}};var I=[];return d.prototype._pushContext=function(){H&&void 0!==this._trace&&I.push(this._trace)},d.prototype._popContext=function(){H&&void 0!==this._trace&&I.pop()},b.prototype._peekContext=f,b.prototype._pushContext=d.prototype._pushContext,b.prototype._popContext=d.prototype._popContext,b.prototype._resolveFromSyncValue=function(a){if(a===C){this._setRejected();var c=a.e;this._settledValue=c,this._cleanValues(),this._attachExtraTrace(c),this._ensurePossibleRejectionHandled()}else{var d=w(a,this);d instanceof b?(d=d._target(),this._follow(d)):(this._setFulfilled(),this._settledValue=a,this._cleanValues())}},y.isSupported()||(b.longStackTraces=function(){},H=!1),b._makeSelfResolutionError=i,a("./finally.js")(b,v,w),a("./direct_resolve.js")(b),a("./synchronous_inspection.js")(b),a("./join.js")(b,x,w,t),b.RangeError=o,b.CancellationError=q,b.TimeoutError=r,b.TypeError=p,b.OperationalError=s,b.RejectionError=s,b.AggregateError=n.AggregateError,l.toFastProperties(b),l.toFastProperties(b.prototype),b.Promise=b,y.setBounds(m.firstLineError,l.lastLineError),a("./nodeify.js")(b),a("./using.js")(b,k,w,e),a("./generators.js")(b,k,t,w),a("./map.js")(b,x,k,w,t),a("./cancel.js")(b,t),a("./promisify.js")(b,t),a("./props.js")(b,x,w,k),a("./race.js")(b,t,w,k),a("./reduce.js")(b,x,k,w,t),a("./settle.js")(b,x),a("./call_get.js")(b),a("./some.js")(b,x,k),a("./progress.js")(b,x),a("./any.js")(b),a("./each.js")(b,t),a("./timers.js")(b,t,w),a("./filter.js")(b,t),b.prototype=b.prototype,b}}).call(this,a("FWaASH"))},{"./any.js":1,"./async.js":2,"./call_get.js":4,"./cancel.js":5,"./captured_trace.js":6,"./catch_filter.js":7,"./direct_resolve.js":8,"./each.js":9,"./errors.js":10,"./filter.js":12,"./finally.js":13,"./generators.js":14,"./join.js":15,"./map.js":16,"./nodeify.js":17,"./progress.js":18,"./promise_array.js":20,"./promise_resolver.js":21,"./promisify.js":22,"./props.js":23,"./race.js":25,"./reduce.js":26,"./settle.js":28,"./some.js":29,"./synchronous_inspection.js":30,"./thenables.js":31,"./timers.js":32,"./using.js":33,"./util.js":34,FWaASH:36}],20:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){switch(a){case-1:return void 0;case-2:return[];case-3:return{}}}function g(a){var d,e=this._promise=new b(c);a instanceof b&&(d=a,e._propagateFrom(d,5)),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var h=a("./util.js"),i=h.isArray;return g.prototype.length=function(){return this._length},g.prototype.promise=function(){return this._promise},g.prototype._init=function j(a,c){var g=d(this._values,this._promise);if(g instanceof b){if(g._setBoundTo(this._promise._boundTo),g=g._target(),this._values=g,!g._isFulfilled())return g._isPending()?void g._then(j,this._reject,void 0,this,c):void this._reject(g._reason());if(g=g._value(),!i(g)){var h=new b.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(h)}}else if(!i(g))return void this._promise._follow(e("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n"));if(0===g.length)return void(-5===c?this._resolveEmptyArray():this._resolve(f(c)));var k=this.getActualLength(g.length);this._length=k,this._values=this.shouldCopyValues()?new Array(k):this._values;for(var l=this._promise,m=0;k>m;++m){var n=this._isResolved(),o=d(g[m],l);o instanceof b?(o=o._target(),n?o._unsetRejectionIsUnhandled():o._isPending()?o._proxyPromiseArray(this,m):o._isFulfilled()?this._promiseFulfilled(o._value(),m):this._promiseRejected(o._reason(),m)):n||this._promiseFulfilled(o,m)}},g.prototype._isResolved=function(){return null===this._values},g.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},g.prototype.__hardReject__=g.prototype._reject=function(a){this._values=null,this._promise._rejectCallback(a,!1,!0)},g.prototype._promiseProgressed=function(a,b){this._promise._progress({index:b,value:a})},g.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},g.prototype._promiseRejected=function(a){this._totalResolved++,this._reject(a)},g.prototype.shouldCopyValues=function(){return!0},g.prototype.getActualLength=function(a){return a},g}},{"./util.js":34}],21:[function(a,b){"use strict";function c(a){return a instanceof Error&&m.getPrototypeOf(a)===Error.prototype}function d(a){var b;if(c(a)){b=new k(a),b.name=a.name,b.message=a.message,b.stack=a.stack;for(var d=m.keys(a),e=0;e<d.length;++e){var f=d[e];n.test(f)||(b[f]=a[f])}return b}return g.markAsOriginatingFromRejection(a),a}function e(a){return function(b,c){if(null!==a){if(b){var e=d(h(b));a._attachExtraTrace(e),a._reject(e)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),i=1;f>i;++i)g[i-1]=arguments[i];a._fulfill(g)}else a._fulfill(c);a=null}}}var f,g=a("./util.js"),h=g.maybeWrapAsError,i=a("./errors.js"),j=i.TimeoutError,k=i.OperationalError,l=g.haveGetters,m=a("./es5.js"),n=/^(?:name|message|stack|cause)$/;if(f=l?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=e(a),this.callback=this.asCallback},l){var o={get:function(){return e(this.promise)}};m.defineProperty(f.prototype,"asCallback",o),m.defineProperty(f.prototype,"callback",o)}f._nodebackForPromise=e,f.prototype.toString=function(){return"[object PromiseResolver]"},f.prototype.resolve=f.prototype.fulfill=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._resolveCallback(a)},f.prototype.reject=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(a)},f.prototype.progress=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(a)},f.prototype.cancel=function(){this.promise.cancel()},f.prototype.timeout=function(){this.reject(new j("timeout"))},f.prototype.isResolved=function(){return this.promise.isResolved()},f.prototype.toJSON=function(){return this.promise.toJSON()},b.exports=f},{"./errors.js":10,"./es5.js":11,"./util.js":34}],22:[function(a,b){"use strict";b.exports=function(b,c){function d(a){return a.replace(/([$])/,"\\$")}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=s.getDataPropertyOrDefault(a,b+c,A);return d?e(d):!1}function g(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new x("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",b))}}function h(a,b,c,d){for(var h=s.inheritedDataKeys(a),i=[],j=0;j<h.length;++j){var k=h[j],l=a[k],m=d===z?!0:z(k,l,a);"function"!=typeof l||e(l)||f(a,k,b)||!d(k,l,a,m)||i.push(k,l)}return g(i,b,c),i}function i(a){for(var b=[a],c=Math.max(0,a-1-5),d=a-1;d>=c;--d)d!==a&&b.push(d);for(var d=a+1;5>=d;++d)b.push(d);return b}function j(a){return s.filledRange(a,"arguments[","]")}function k(a){return s.filledRange(a,"_arg","")}function l(a){return"number"==typeof a.length?Math.max(Math.min(a.length,1024),0):0}function m(a){return s.isIdentifier(a)?"."+a:"['"+a.replace(/(['\\])/g,"\\$1")+"']"}function n(a,d,e,f,g){function h(b){var c,e=j(b).join(", "),f=b>0?", ":"";return c="string"==typeof a?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",m(a)):d===r?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==d?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",c.replace("{{args}}",e).replace(", ",f)}function n(){for(var b="",c=0;c<p.length;++c)b+="case "+p[c]+":"+h(p[c]);var e;return e="string"==typeof a?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",m(a)):d===r?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",b+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",e)}var o=Math.max(0,l(f)-1),p=i(o),q="string"==typeof e&&s.isIdentifier(e)?e+g:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function (Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            promise._setIsSpreadable();                                      \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",q).replace("Parameters",k(o)).replace("[CodeForSwitchCase]",n()))(b,a,d,u,v,t,c)}function o(a,d){function e(){var e=d;d===r&&(e=this),"string"==typeof a&&(a=e[a]);var f=new b(c);f._captureStackTrace(),f._setIsSpreadable();var g=t(f);try{a.apply(e,u(arguments,g))}catch(h){var i=v(h);f._attachExtraTrace(i),f._reject(i)}return f}return e.__isPromisified__=!0,e}function p(a,b,c,e){for(var f=new RegExp(d(b)+"$"),g=h(a,b,f,c),i=0,j=g.length;j>i;i+=2){var k=g[i],l=g[i+1],m=k+b;a[m]=e===B?B(k,r,k,l,b):e(l,function(){return B(k,r,k,l,b)})}return s.toFastProperties(a),a}function q(a,b){return B(a,b,void 0,a)}var r={},s=a("./util.js"),t=a("./promise_resolver.js")._nodebackForPromise,u=s.withAppended,v=s.maybeWrapAsError,w=s.canEvaluate,x=a("./errors").TypeError,y="Async",z=function(a,b){return s.isIdentifier(a)&&"_"!==a.charAt(0)&&!s.isClass(b)},A={__isPromisified__:!0},B=w?n:o;b.promisify=function(a,b){if("function"!=typeof a)throw new x("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return e(a)?a:q(a,arguments.length<2?r:b)},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new x("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");b=Object(b);var c=b.suffix;"string"!=typeof c&&(c=y);var d=b.filter;"function"!=typeof d&&(d=z);var e=b.promisifier;if("function"!=typeof e&&(e=B),!s.isIdentifier(c))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var f=s.inheritedDataKeys(a,{includeHidden:!0}),g=0;g<f.length;++g){var h=a[f[g]];"constructor"!==f[g]&&s.isClass(h)&&(p(h.prototype,c,d,e),p(h,c,d,e))}return p(a,c,d,e)}}},{"./errors":10,"./promise_resolver.js":21,"./util.js":34}],23:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){for(var b=j.keys(a),c=b.length,d=new Array(2*c),e=0;c>e;++e){var f=b[e];d[e]=a[f],d[e+c]=f}this.constructor$(d)}function g(a){var c,g=d(a);return i(g)?(c=g instanceof b?g._then(b.props,void 0,void 0,void 0,void 0):new f(g).promise(),g instanceof b&&c._propagateFrom(g,4),c):e("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var h=a("./util.js"),i=h.isObject,j=a("./es5.js");h.inherits(f,c),f.prototype._init=function(){this._init$(void 0,-3)},f.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){for(var d={},e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f];this._resolve(d)}},f.prototype._promiseProgressed=function(a,b){this._promise._progress({key:this._values[b+this.length()],value:a})},f.prototype.shouldCopyValues=function(){return!1},f.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return g(this)},b.props=function(a){return g(a)}}},{"./es5.js":11,"./util.js":34}],24:[function(a,b){"use strict";function c(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b],a[f+b]=void 0}function d(a){this._capacity=a,this._length=0,this._front=0}d.prototype._willBeOverCapacity=function(a){return this._capacity<a},d.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},d.prototype._unshiftOne=function(a){var b=this._capacity;this._checkCapacity(this.length()+1);var c=this._front,d=(c-1&b-1^b)-b;this[d]=a,this._front=d,this._length=this.length()+1},d.prototype.unshift=function(a,b,c){this._unshiftOne(c),this._unshiftOne(b),this._unshiftOne(a)},d.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},d.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},d.prototype.length=function(){return this._length},d.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<1)},d.prototype._resizeTo=function(a){var b=this._capacity;this._capacity=a;var d=this._front,e=this._length;if(d+e>b){var f=d+e&b-1;c(this,0,this,b,f)}},b.exports=d},{}],25:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,f){var i=d(a);if(i instanceof b)return h(i);if(!g(a))return e("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var j=new b(c);void 0!==f&&j._propagateFrom(f,5);for(var k=j._fulfill,l=j._reject,m=0,n=a.length;n>m;++m){var o=a[m];(void 0!==o||m in a)&&b.cast(o)._then(k,l,void 0,j,null)}return j}var g=a("./util.js").isArray,h=function(a){return a.then(function(b){return f(b,a)})};b.race=function(a){return f(a,void 0)},b.prototype.race=function(){return f(this,void 0)}}},{"./util.js":34}],26:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,c,d,g){this.constructor$(a),this._promise._captureStackTrace(),this._preservedValues=g===f?[]:null,this._zerothIsAccum=void 0===d,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var h=e(d,this._promise),i=!1,j=h instanceof b;j&&(h=h._target(),h._isPending()?h._proxyPromiseArray(this,-1):h._isFulfilled()?(d=h._value(),this._gotAccum=!0):(this._reject(h._reason()),i=!0)),j||this._zerothIsAccum||(this._gotAccum=!0),this._callback=c,this._accum=d,i||this._init$(void 0,-5)}function h(a,b,c,e){if("function"!=typeof b)return d("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var f=new g(a,b,c,e);return f.promise()}var i=a("./util.js"),j=i.tryCatch,k=i.errorObj;i.inherits(g,c),g.prototype._init=function(){},g.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},g.prototype._promiseFulfilled=function(a,c){var d=this._values;d[c]=a;var f,g=this.length(),h=this._preservedValues,i=null!==h,l=this._gotAccum,m=this._valuesPhase;if(!m)for(m=this._valuesPhase=Array(g),f=0;g>f;++f)m[f]=0;if(f=m[c],0===c&&this._zerothIsAccum?(l||(this._accum=a,this._gotAccum=l=!0),m[c]=0===f?1:2):-1===c?l||(this._accum=a,this._gotAccum=l=!0):0===f?m[c]=1:(m[c]=2,l&&(this._accum=a)),l){for(var n,o=this._callback,p=this._promise._boundTo,q=this._reducingIndex;g>q;++q)if(f=m[q],2!==f){if(1!==f)return;if(a=d[q],a instanceof b){if(a=a._target(),!a._isFulfilled())return a._isPending()?void 0:this._reject(a._reason());a=a._value()}if(this._promise._pushContext(),i?(h.push(a),n=j(o).call(p,a,q,g)):n=j(o).call(p,this._accum,a,q,g),this._promise._popContext(),n===k)return this._reject(n.e);var r=e(n,this._promise);if(r instanceof b){if(r=r._target(),r._isPending())return m[q]=4,r._proxyPromiseArray(this,q);if(!r._isFulfilled())return this._reject(r._reason());n=r._value()}this._reducingIndex=q+1,this._accum=n}else this._reducingIndex=q+1;this._reducingIndex<g||this._resolve(i?h:this._accum)}},b.prototype.reduce=function(a,b){return h(this,a,b,null)},b.reduce=function(a,b,c,d){return h(a,b,c,d)}}},{"./util.js":34}],27:[function(a,b){(function(a){"use strict";var c;"object"==typeof a&&"string"==typeof a.version?c=parseInt(a.version.split(".")[1],10)>10?setImmediate:a.nextTick:"undefined"!=typeof MutationObserver?(c=function(a){var b=document.createElement("div"),c=new MutationObserver(a);return c.observe(b,{attributes:!0}),function(){b.classList.toggle("foo")}},c.isStatic=!0):c="undefined"!=typeof setTimeout?function(a){setTimeout(a,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")},b.exports=c}).call(this,a("FWaASH"))},{FWaASH:36}],28:[function(a,b){"use strict";b.exports=function(b,c){function d(a){this.constructor$(a),this._promise._setIsSpreadable()}var e=b.PromiseInspection,f=a("./util.js");f.inherits(d,c),d.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},d.prototype._promiseFulfilled=function(a,b){var c=new e;c._bitField=268435456,c._settledValue=a,this._promiseResolved(b,c)},d.prototype._promiseRejected=function(a,b){var c=new e;c._bitField=134217728,c._settledValue=a,this._promiseResolved(b,c)},b.settle=function(a){return new d(a).promise()},b.prototype.settle=function(){return new d(this).promise()}}},{"./util.js":34}],29:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){if((0|b)!==b||0>b)return d("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var c=new e(a),f=c.promise();return f.isRejected()?f:(c.setHowMany(b),c.init(),f)}var g=a("./util.js"),h=a("./errors.js").RangeError,i=a("./errors.js").AggregateError,j=g.isArray;g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(this._promise._setIsSpreadable(),0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._isResolved()||(this._howMany=a)},e.prototype._promiseFulfilled=function(a){this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values))},e.prototype._promiseRejected=function(a){if(this._addRejected(a),this.howMany()>this._canPossiblyFulfill()){for(var b=new i,c=this.length();c<this._values.length;++c)b.push(this._values[c]);this._reject(b)}},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors.js":10,"./util.js":34}],30:[function(a,b){"use strict";b.exports=function(a){function b(a){void 0!==a?(a=a._target(),this._bitField=a._bitField,this._settledValue=a._settledValue):(this._bitField=0,this._settledValue=void 0)}b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},b.prototype.isFulfilled=a.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype._isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype._isPending=function(){return 0===(402653184&this._bitField)},b.prototype.isResolved=a.prototype._isResolved=function(){return(402653184&this._bitField)>0},a.prototype.isPending=function(){return this._target()._isPending()
},a.prototype.isRejected=function(){return this._target()._isRejected()},a.prototype.isFulfilled=function(){return this._target()._isFulfilled()},a.prototype.isResolved=function(){return this._target()._isResolved()},a.prototype._value=function(){return this._settledValue},a.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},a.prototype.value=function(){var a=this._target();if(!a.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return a._settledValue},a.prototype.reason=function(){var a=this._target();if(!a.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return a._settledValue},a.PromiseInspection=b}},{}],31:[function(a,b){"use strict";b.exports=function(b,c){function d(a,d){if(j(a)){if(a instanceof b)return a;if(f(a)){var k=new b(c);return a._then(k._fulfillUnchecked,k._rejectUncheckedCheckError,k._progressUnchecked,k,null),k}var l=h.tryCatch(e)(a);if(l===i){d&&d._pushContext();var k=b.reject(l.e);return d&&d._popContext(),k}if("function"==typeof l)return g(a,l,d)}return a}function e(a){return a.then}function f(a){return k.call(a,"_promise0")}function g(a,d,e){function f(c){return a===c?k._rejectCallback(b._makeSelfResolutionError(),!1,!0):void k._resolveCallback(c)}function g(a){k._rejectCallback(a,l,!0)}function j(a){"function"==typeof k._progress&&k._progress(a)}var k=new b(c);e&&e._pushContext(),k._captureStackTrace(),e&&e._popContext();var l=!0,m=h.tryCatch(d).call(a,f,g,j);return l=!1,m===i&&k._rejectCallback(m.e,!0,!0),k}var h=a("./util.js"),i=h.errorObj,j=h.isObject,k={}.hasOwnProperty;return d}},{"./util.js":34}],32:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){var b=this;return b instanceof Number&&(b=+b),clearTimeout(b),a}function f(a){var b=this;throw b instanceof Number&&(b=+b),clearTimeout(b),a}var g=a("./util.js"),h=b.TimeoutError,i=function(a,b){if(a.isPending()){"string"!=typeof b&&(b="operation timed out");var c=new h(b);g.markAsOriginatingFromRejection(c),a._attachExtraTrace(c),a._cancel(c)}},j=function(a,b){b._fulfill(a)},k=b.delay=function(a,e){void 0===e&&(e=a,a=void 0),e=+e;var f=d(a),g=new b(c);return f instanceof b?(g._propagateFrom(f,5),g._follow(f._target()),g.then(function(a){return b.delay(a,e)})):(setTimeout(function(){j(a,g)},e),g)};b.prototype.delay=function(a){return k(this,a)},b.prototype.timeout=function(a,d){var g=this._target();a=+a;var h=new b(c).cancellable();h._propagateFrom(this,5),h._follow(g);var j=setTimeout(function(){i(h,d)},a);return h._then(e,f,void 0,j,void 0)}}},{"./util.js":34}],33:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){for(var c=a.length,d=0;c>d;++d){var e=a[d];if(e.isRejected())return b.reject(e.error());a[d]=e._settledValue}return a}function g(a){setTimeout(function(){throw a},0)}function h(a){var b=d(a);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function i(a,c){function e(){if(f>=i)return j.resolve();var k=h(a[f++]);if(k instanceof b&&k._isDisposable()){try{k=d(k._getDisposer().tryDispose(c),a.promise)}catch(l){return g(l)}if(k instanceof b)return k._then(e,g,null,null,null)}e()}var f=0,i=a.length,j=b.defer();return e(),j.promise}function j(a){var b=new q;return b._settledValue=a,b._bitField=268435456,i(this,b).thenReturn(a)}function k(a){var b=new q;return b._settledValue=a,b._bitField=134217728,i(this,b).thenThrow(a)}function l(a,b,c){this._data=a,this._promise=b,this._context=c}function m(a,b){this.constructor$(a,b)}function n(a){return l.isDisposer(a)?(this.resources[this.index]._setDisposable(a),a.promise()):a}var o=a("./errors.js").TypeError,p=a("./util.js").inherits,q=b.PromiseInspection;l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},l.prototype.tryDispose=function(a){var b=this.resource(),c=this._context;void 0!==c&&c._pushContext();var d=null!==b?this.doDispose(b,a):null;return void 0!==c&&c._popContext(),this._promise._unsetDisposable(),this._data=null,d},l.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},p(m,l),m.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},b.using=function(){var a=arguments.length;if(2>a)return c("you must pass at least 2 arguments to Promise.using");var e=arguments[a-1];if("function"!=typeof e)return c("fn must be a function\n\n    See http://goo.gl/916lJJ\n");a--;for(var g=new Array(a),h=0;a>h;++h){var i=arguments[h];if(l.isDisposer(i)){var m=i;i=i.promise(),i._setDisposable(m)}else{var o=d(i);o instanceof b&&(i=o._then(n,null,null,{resources:g,index:h},void 0))}g[h]=i}var p=b.settle(g).then(f).then(function(a){p._pushContext();var b;try{b=e.apply(void 0,a)}finally{p._popContext()}return b})._then(j,k,void 0,g,void 0);return g.promise=p,p},b.prototype._setDisposable=function(a){this._bitField=262144|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(262144&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new m(a,this,e());throw new o}}},{"./errors.js":10,"./util.js":34}],34:[function(a,b,c){"use strict";function d(){try{return z.apply(this,arguments)}catch(a){return y.e=a,y}}function e(a){return z=a,d}function f(a){return"string"==typeof a?a:""+a}function g(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function h(a){return!g(a)}function i(a){return g(a)?new Error(f(a)):a}function j(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function k(a,b,c){if(!v.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function l(a,b,c){if(g(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return v.defineProperty(a,b,d),a}function m(a){throw a}function n(a){try{if("function"==typeof a){var b=v.keys(a.prototype);return b.length>0&&!(1===b.length&&"constructor"===b[0])}return!1}catch(c){return!1}}function o(a){function b(){}return b.prototype=a,b}function p(a){return D.test(a)}function q(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}function r(a){try{return a+""}catch(b){return"[no string representation]"}}function s(a){try{l(a,"isOperational",!0)}catch(b){}}function t(a){return null==a?!1:a instanceof Error.__BluebirdErrorTypes__.OperationalError||a.isOperational===!0}function u(a){return a instanceof Error&&v.propertyIsWritable(a,"stack")}var v=a("./es5.js"),w="undefined"==typeof navigator,x=function(){try{var a={};return v.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(b){return!1}}(),y={e:{}},z,A=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},B=function(){return"string"!==this}.call("string"),C=function(){return v.isES5?function(a,b){for(var c=[],d=Object.create(null),e=Object(b).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=a;){var f;try{f=e(a)}catch(g){return c}for(var h=0;h<f.length;++h){var i=f[h];if(!d[i]){d[i]=!0;var j=Object.getOwnPropertyDescriptor(a,i);null!=j&&null==j.get&&null==j.set&&c.push(i)}}a=v.getPrototypeOf(a)}return c}:function(a){var b=[];for(var c in a)b.push(c);return b}}(),D=/^[a-z$_][a-z$_0-9]*$/i,E=function(){return"stack"in new Error?function(a){return u(a)?a:new Error(r(a))}:function(a){if(u(a))return a;try{throw new Error(r(a))}catch(b){return b}}}(),F={isClass:n,isIdentifier:p,inheritedDataKeys:C,getDataPropertyOrDefault:k,thrower:m,isArray:v.isArray,haveGetters:x,notEnumerableProp:l,isPrimitive:g,isObject:h,canEvaluate:w,errorObj:y,tryCatch:e,inherits:A,withAppended:j,asString:f,maybeWrapAsError:i,wrapsPrimitiveReceiver:B,toFastProperties:o,filledRange:q,toString:r,canAttachTrace:u,ensureErrorObject:E,originatesFromRejection:t,markAsOriginatingFromRejection:s};try{throw new Error}catch(G){F.lastLineError=G}b.exports=F},{"./es5.js":11}],35:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],36:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],37:[function(a,b){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],38:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a){return a}function h(a){var b={};return a.forEach(function(a){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)f.push(F(b,String(g))?m(a,b,c,d,String(g),!0):"");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("FWaASH"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":37,FWaASH:36,inherits:40}],39:[function(a,b){var c,d=Object.prototype.hasOwnProperty,e=Object.prototype.toString,f=function(a){"use strict";if(!a||"[object Object]"!==e.call(a)||a.nodeType||a.setInterval)return!1;var b=d.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!b&&!f)return!1;var g;for(g in a);return g===c||d.call(a,g)};b.exports=function g(){"use strict";var a,b,d,e,h,i,j=arguments[0],k=1,l=arguments.length,m=!1;for("boolean"==typeof j?(m=j,j=arguments[1]||{},k=2):("object"!=typeof j&&"function"!=typeof j||j==c)&&(j={});l>k;++k)if(null!=(a=arguments[k]))for(b in a)d=j[b],e=a[b],j!==e&&(m&&e&&(f(e)||(h=Array.isArray(e)))?(h?(h=!1,i=d&&Array.isArray(d)?d:[]):i=d&&f(d)?d:{},j[b]=g(m,i,e)):e!==c&&(j[b]=e));return j}},{}],40:[function(a,b){b.exports="function"==typeof Object.create?function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],41:[function(a,b){function c(){this.emitting=!1,e.call(this)}function d(a,b){var c=!1;if(Array.isArray(a)&&Array.isArray(b))for(var d=0;d<a.length;d++)if(-1!==b.indexOf(a[d])){c=!0;break}return c}var e=a("events").EventEmitter,f=a("util");f.inherits(c,e),c.prototype.emit=function(a){var b=arguments,c=[],f=this;return a=Array.isArray(a)?a:a.split(" "),a.forEach(function(a){var g,h=[],i=[];if(-1!==a.indexOf(".")&&f._events&&(h=a.split("."),a=h.shift(),g=f._events[a]))if(Array.isArray(g)){if(g.forEach(function(a){d(h,a.__eens)&&i.push(a)}),!i.length)return;f._events[a]=i}else if(0==d(h,g.__eens))return;f.emitting={event:a,namespaces:h},b[0]=a,c.push(e.prototype.emit.apply(f,b)),f.emitting=!1,i.length&&(f._events[a]=g)}),1==c.length?c[0]:c},c.prototype.addListener=function(a,b){var c,d;return-1!==(d=a.indexOf("."))&&"function"==typeof b&&(b=b.bind(),c=a.split("."),a=c.shift(),b.__eens=c),e.prototype.addListener.call(this,a,b)},c.prototype.on=function(a,b){var c,d=Array.isArray(a),f=this;"string"==typeof a||d?(a=d?a:a.split(" "),a.forEach(function(a){f.addListener(a,b)})):"object"==typeof a?(c=Object.keys(a),c.forEach(function(b){f.addListener(b,a[b])})):e.prototype.addListener.call(this,a,b)},c.prototype.removeListener=function(a,b){return-1!==a.indexOf(".")&&(a=a.split(".").shift()),e.prototype.removeListener.call(this,a,b)},c.prototype.removeAllListeners=function(a){var b;return-1!==a.indexOf(".")?(b=a.split("."),a=b.shift(),a?this._offNs(b,a):this._events&&Object.keys(this._events).forEach(this._offNs.bind(this,b))):e.prototype.removeAllListeners.call(this,a),this},c.prototype._offNs=function(a,b){var c=this._events&&this._events[b],e=this;c&&(Array.isArray(c)?c.forEach(function(c){d(a,c.__eens)&&e.removeListener(b,c)}):d(a,c.__eens)&&this.removeListener(b,c))},c.prototype.off=function(a,b){var c,d=Array.isArray(a),e=this,f="function"==typeof b;return"string"==typeof a||d?(a=d?a:a.split(" "),a.forEach(function(a){f?e.removeListener(a,b):e.removeAllListeners(a)})):"object"==typeof a&&(c=Object.keys(a),c.forEach(function(b){"function"==typeof a[b]?e.removeListener(b,a[b]):e.removeAllListeners(b)})),this},b.exports=function(a){return a}.bind(null,new c);var g={};b.exports.create=function(a){var b;return b=a&&g[a]?g[a]:new c},b.exports.EventEmitter=c},{events:35,util:38}],42:[function(a,b){b.exports=function(){function b(f){var g=this;if(!(g instanceof b))throw new Error("usage: new Hoodie(url);");g.baseUrl=f?f.replace(/\/+$/,""):"",g.extend=function(a){a(g,d,e)},e.events(g),g.extend(a("./hoodie/id")),g.extend(a("./hoodie/open")),g.extend(a("./hoodie/request")),g.extend(a("./hoodie/connection")),g.extend(a("./hoodie/store")),g.extend(a("./hoodie/account")),g.extend(a("./hoodie/remote")),g.extend(a("./hoodie/task")),g.account.authenticate().then(function(){return g.remote.connect()})["catch"](function(){}),c(g)}function c(a){for(var b=0;b<f.length;b++)f[b](a,d,e)}var d=a("./lib"),e=a("./utils"),f=[];return b.extend=function(a){f.push(a)},b}()},{"./hoodie/account":45,"./hoodie/connection":46,"./hoodie/id":47,"./hoodie/open":48,"./hoodie/remote":49,"./hoodie/request":50,"./hoodie/store":54,"./hoodie/task":58,"./lib":64,"./utils":79}],43:[function(a,b,c){(function(b){var d=a("./helpers"),e=a("../../utils"),f=e.generateId,g=e.config,h=e.promise,i=h.reject,j=h.resolve,k=h.rejectWith,l=h.resolveWith;c.authenticate=function(a){var b=a.requests;return a.authenticated===!1?i():a.authenticated===!0?l(a.username):b.signOut&&"pending"===b.signOut.state?b.signOut.then(i):b.signIn&&"pending"===b.signIn.state?a.requests.signIn:c.hasAccount(a)?d.withSingleRequest(a,"authenticate",function(){return c.request(a,"GET","/_session").then(d.handleAuthenticateRequestSuccess.bind(null,a))}):d.sendSignOutRequest(a).then(function(){return a.authenticated=!1,i()})},c.hasValidSession=function(a){return c.hasAccount(a)?a.authenticated===!0:!1},c.hasInvalidSession=function(a){return c.hasAccount(a)?a.authenticated===!1:!1},c.signUp=function(a,b,e){return void 0===e&&(e=""),b?c.hasAnonymousAccount(a)?d.upgradeAnonymousAccount(a,b,e):c.hasAccount(a)?k("Must sign out first."):d.sendSignUpRequest(a,b,e).done(function(){d.setUsername(a,b),a.events.trigger("signup",b)}):k("Username must be set.")},c.anonymousSignUp=function(a){var b,c;return b=f(10),c=a.hoodie.id(),d.sendSignUpRequest(a,c,b).progress(function(){d.setAnonymousPassword(a,b)}).done(function(){a.events.trigger("signup:anonymous")}).then(function(){return j()})},c.hasAccount=function(a){var b=!!a.username;return b||c.hasAnonymousAccount(a)},c.hasAnonymousAccount=function(a){return!!d.getAnonymousPassword(a)},c.signIn=function(a,b,e,f){var g,h,i=b===a.username;return b||(b=""),e||(e=""),b=b.toLowerCase(),f=f||{},g=f.silent,h=!c.hasAccount(a)||i||f.moveData?d.sendSignInRequest(a,b,e,f):d.pushLocalChanges(a,f).then(function(){return d.sendSignInRequest(a,b,e,f)}),i||h.done(d.disconnect.bind(null,a)),h.done(function(b){f.moveData&&a.events.trigger("movedata"),i||f.moveData||(d.cleanup(a),d.setBearerToken(a,a.newBearerToken)),i?g||a.events.trigger("reauthenticated",b):(d.setUsername(a,b),g||a.events.trigger("signin",b,a.newHoodieId,f))}),h},c.signOut=function(a,b){var e,f,g;return b=b||{},e=b.silent?d.cleanup:d.cleanupAndTriggerSignOut,g=a.username,f=c.hasAccount(a)?b.moveData?d.sendSignOutRequest(a):d.pushLocalChanges(a,b).then(d.disconnect.bind(null,a)).then(d.sendSignOutRequest.bind(null,a)).then(e.bind(null,a)):e(a),f.then(function(){return l(g)})},c.request=function(a,b,c,d){return a.hoodie.request.apply(a.hoodie,[b,c,d||{}])},c.db=function(a){return"user/"+a.hoodie.id()},c.fetch=function(a,b){var e=c.hasAnonymousAccount(a)?a.hoodie.id():a.username;return void 0===b&&(b=e),b?d.withSingleRequest(a,"fetch",function(){return c.request(a,"GET",d.userDocUrl(a,b)).done(function(b){return a.userDoc=b,a.userDoc})}):k({name:"HoodieUnauthorizedError",message:"Not signed in"})},c.changePassword=function(a,b,e){return a.username?(d.disconnect(a),c.fetch(a).then(d.sendChangeUsernameAndPasswordRequest(a,b,null,e)).then(function(){return j()}).done(function(){a.events.trigger("changepassword")})):k({name:"HoodieUnauthorizedError",message:"Not signed in"})},c.resetPassword=function(a,b){var e,h,i,j;return(j=g.get("_account.resetPasswordId"))?c.checkPasswordReset(a):(j=""+b+"/"+f(),g.set("_account.resetPasswordId",j),h=""+a.userDocPrefix+":$passwordReset/"+j,e={_id:h,name:"$passwordReset/"+j,type:"user",roles:[],password:j,createdAt:d.now(a),updatedAt:d.now(a)},i={data:JSON.stringify(e),contentType:"application/json"},d.withPreviousRequestsAborted(a,"resetPassword",function(){return c.request(a,"PUT","/_users/"+encodeURIComponent(h),i).done(c.checkPasswordReset.bind(null,a)).then(d.awaitPasswordResetResult.bind(null,a)).done(function(){a.events.trigger("resetpassword")})}))},c.checkPasswordReset=function(a){var e,f,h,i,j,l;return(h=g.get("_account.resetPasswordId"))?(j=h.split("/")[0],l="$passwordReset/"+h,i="/_users/"+encodeURIComponent(a.userDocPrefix+":"+l),e=btoa(l+":"+h),f={headers:{Authorization:"Basic "+e}},d.withSingleRequest(a,"passwordResetStatus",function(){return c.request(a,"GET",i,f).then(d.handlePasswordResetStatusRequestSuccess.bind(null,a),d.handlePasswordResetStatusRequestError(a,j)).fail(function(d){return"HoodiePendingError"===d.name?void b.setTimeout(c.checkPasswordReset.bind(null,a),1e3):a.events.trigger("error:passwordreset",d,j)})})):k("No pending password reset.")},c.changeUsername=function(a,b,e){var f=c.hasAnonymousAccount(a)?a.hoodie.id():a.username;return e!==f?(e=e||"",d.changeUsernameAndPassword(a,b,e.toLowerCase()).done(function(){d.setUsername(a,e),a.events.trigger("changeusername",e)})):k({name:"HoodieConflictError",message:"Usernames identical"})},c.destroy=function(a){var b,e=a.username;return b=c.hasAccount(a)?c.fetch(a).then(d.handleFetchBeforeDestroySuccess.bind(null,a),d.handleFetchBeforeDestroyError.bind(null,a)).then(d.cleanupAndTriggerSignOut.bind(null,a)).then(function(){return e}):d.cleanupAndTriggerSignOut(a),b.then(function(){return a.events.trigger("destroy",e),l(e)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":79,"./helpers":44}],44:[function(a,b,c){(function(b){var d=a("extend"),e=a("../../utils"),f=e.config,g=e.promise,h=g.defer,i=g.reject,j=g.rejectWith,k=g.resolveWith,l=g.resolve,m="_account.anonymousPassword";c.setAnonymousPassword=function(a,b){return f.set(m,b)},c.getAnonymousPassword=function(){return f.get(m)},c.removeAnonymousPassword=function(){return f.unset(m)},c.anonymousSignIn=function(a){var b=a.hoodie.id(),d=c.getAnonymousPassword(a);return a.hoodie.account.signIn(b,d).done(function(){a.events.trigger("signin:anonymous",b)})},c.reauthenticate=function(a){return a.authenticated=void 0,a.hoodie.account.authenticate()},c.setUsername=function(a,b){return a.username!==b?(a.username=b,f.set("_account.username",b)):void 0},c.setBearerToken=function(a,b){return a.hoodie.account.bearerToken!==b?(a.hoodie.account.bearerToken=b,f.set("_account.bearerToken",b)):void 0},c.handleAuthenticateRequestSuccess=function(a,b){return b.userCtx.name?(a.authenticated=!0,k(a.username)):a.hoodie.account.hasAnonymousAccount()?c.anonymousSignIn(a):(a.authenticated=!1,a.events.trigger("error:unauthenticated"),i())},c.handleSignUpSuccess=function(a,b,d){return function(e){return a.userDoc._rev=e.rev,c.delayedSignIn(a,b,d)}},c.handleSignUpError=function(a,b){return function(a){return"HoodieConflictError"===a.name&&(a.message="Username "+b+" already exists"),j(a)}},c.delayedSignIn=function(a,d,e,f,g){return g||(g=h()),b.setTimeout(function(){var b=c.sendSignInRequest(a,d,e,f);b.done(g.resolve),b.fail(function(b){"HoodieAccountUnconfirmedError"===b.name?c.delayedSignIn(a,d,e,f,g):g.reject.apply(g,arguments)})},300),g.promise},c.handleSignInSuccess=function(a,b){return b=b||{},function(b){var d,e,f;return d=b.name.replace(/^user(_anonymous)?\//,""),e=b.roles[0],f=b.bearerToken,-1!==b.roles.indexOf("error")?a.hoodie.account.fetch(d).then(function(){return j(a.userDoc.$error)}):-1===b.roles.indexOf("confirmed")?j({name:"HoodieAccountUnconfirmedError",message:"Account has not been confirmed yet"}):(a.authenticated=!0,a.newHoodieId=e,a.newBearerToken=f,c.setBearerToken(a,f),a.hoodie.account.fetch(d),k(d))}},c.handlePasswordResetStatusRequestSuccess=function(a,b){var c;return b.$error?(c=b.$error,c.object=b,delete c.object.$error):c={name:"HoodiePendingError",message:"Password reset is still pending"},j(c)},c.handlePasswordResetStatusRequestError=function(a,b){return function(c){return"HoodieUnauthorizedError"===c.name?(f.unset("_account.resetPasswordId"),a.events.trigger("passwordreset",b),l()):j(c)}},c.awaitPasswordResetResult=function(a){var b=h();return a.events.once("passwordreset",b.resolve),a.events.on("error:passwordreset",c.removePasswordResetObject.bind(null,a)),a.events.on("error:passwordreset",b.reject),b.always(function(){a.events.removeListener("passwordreset",b.resolve),a.events.removeListener("error:passwordreset",c.removePasswordResetObject.bind(null,a)),a.events.removeListener("error:passwordreset",b.reject)}),b.promise},c.removePasswordResetObject=function(a,b){var c=b.object,d=c.name,e=d.substr(15),g="/_users/"+encodeURIComponent(a.userDocPrefix+":"+d),h=btoa(d+":"+e);c._deleted=!0;var i={headers:{Authorization:"Basic "+h},contentType:"application/json",data:JSON.stringify(c)};a.hoodie.account.request("PUT",g,i),f.unset("_account.resetPasswordId")},c.changeUsernameAndPassword=function(a,b,d,e){var f=a.hoodie.account.hasAnonymousAccount()?a.hoodie.id():a.username;
return c.sendSignInRequest(a,f,b).then(function(){return a.hoodie.account.fetch().then(c.sendChangeUsernameAndPasswordRequest(a,b,d,e))})},c.upgradeAnonymousAccount=function(a,b,d){var e=c.getAnonymousPassword(a);return c.changeUsernameAndPassword(a,e,b,d).done(function(){a.events.trigger("signup",b),c.removeAnonymousPassword(a)})},c.handleFetchBeforeDestroySuccess=function(a){return c.disconnect(a),a.userDoc._deleted=!0,c.withPreviousRequestsAborted(a,"updateUsersDoc",function(){a.hoodie.account.request("PUT",c.userDocUrl(a),{data:JSON.stringify(a.userDoc),contentType:"application/json"})})},c.handleFetchBeforeDestroyError=function(a,b){return"HoodieNotFoundError"===b.name?l():j(b)},c.cleanup=function(a){return a.events.trigger("cleanup"),a.authenticated=void 0,c.setUsername(a,void 0),c.setBearerToken(a,void 0),l()},c.disconnect=function(a){return a.hoodie.remote.disconnect()},c.cleanupAndTriggerSignOut=function(a){var b=a.username;return c.cleanup(a).then(function(){return a.events.trigger("signout",b)})},c.userTypeAndId=function(a,b){var c;return c=b===a.hoodie.id()?"user_anonymous":"user",""+c+"/"+b},c.userDocKey=function(a,b){var d=a.hoodie.account.hasAnonymousAccount()?a.hoodie.id():a.username;return b=b||d,""+a.userDocPrefix+":"+c.userTypeAndId(a,b)},c.userDocUrl=function(a,b){return"/_users/"+encodeURIComponent(c.userDocKey(a,b))},c.sendChangeUsernameAndPasswordRequest=function(a,b,e,f){return function(){var g=d({},a.userDoc);e&&(g.$newUsername=e),g.updatedAt=c.now(a),g.signedUpAt=g.signedUpAt||c.now(a),void 0!==f&&(delete g.salt,delete g.password_sha,g.password=f);var h={data:JSON.stringify(g),contentType:"application/json"};return c.withPreviousRequestsAborted(a,"updateUsersDoc",function(){return a.hoodie.account.request("PUT",c.userDocUrl(a),h).then(c.handleChangeUsernameAndPasswordResponse(a,e,f||b))})}},c.handleChangeUsernameAndPasswordResponse=function(a,b,d){var e=a.hoodie.account.hasAnonymousAccount()?a.hoodie.id():a.username;return function(){return c.disconnect(a),b?c.awaitCurrentAccountRemoved(a,e,d).then(function(){return a.hoodie.account.signOut({silent:!0,moveData:!0}).then(function(){return a.hoodie.account.signIn(b,d,{moveData:!0,silent:!0})})}):a.hoodie.account.signIn(e,d,{silent:!0})}},c.awaitCurrentAccountRemoved=function(a,d,e,f){f||(f=h());var g={data:{name:c.userTypeAndId(a,d),password:e}};return c.withPreviousRequestsAborted(a,"signIn",function(){return a.hoodie.account.request("POST","/_session",g)}).done(function(){b.setTimeout(c.awaitCurrentAccountRemoved.bind(null,a),300,d,e,f)}).fail(function(a){return 401===a.status?f.resolve():void f.reject(a)}),f.promise},c.withPreviousRequestsAborted=function(a,b,c){return void 0!==a.requests[b]&&"function"==typeof a.requests[b].abort&&a.requests[b].abort(),a.requests[b]=c(),a.requests[b]},c.withSingleRequest=function(a,b,c){return a.requests[b]&&"pending"===a.requests[b].state?a.requests[b]:(a.requests[b]=c(),a.requests[b].state="pending",a.requests[b].then(function(){a.requests[b].state="fullfiled"},function(){a.requests[b].state="rejected"}),a.requests[b])},c.pushLocalChanges=function(a,b){return a.hoodie.store.hasLocalChanges()&&!b.ignoreLocalChanges?a.hoodie.remote.push():l()},c.sendSignOutRequest=function(a){return c.withSingleRequest(a,"signOut",function(){return a.hoodie.account.request("DELETE","/_session")})},c.sendSignInRequest=function(a,b,d,e){var f={data:{name:c.userTypeAndId(a,b),password:d}};return c.withPreviousRequestsAborted(a,"signIn",function(){var b=a.hoodie.account.request("POST","/_session",f);return b.then(c.handleSignInSuccess(a,e))})},c.sendSignUpRequest=function(a,b,d){var e,f=h();return b=b.toLowerCase(),e={data:JSON.stringify({_id:c.userDocKey(a,b),name:c.userTypeAndId(a,b),type:"user",roles:[],password:d,hoodieId:a.hoodie.id(),database:a.hoodie.account.db(),updatedAt:c.now(a),createdAt:c.now(a),signedUpAt:b!==a.hoodie.id()?c.now(a):void 0}),contentType:"application/json"},a.hoodie.account.request("PUT",c.userDocUrl(a,b),e).done(f.notify).then(c.handleSignUpSuccess(a,b,d),c.handleSignUpError(a,b)).then(f.resolve,f.reject),f.promise},c.now=function(){return new Date}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":79,extend:39}],45:[function(a,b){var c=a("../../utils"),d=a("./api"),e=a("./helpers");b.exports=function(a){var b={},f=c.config.get("_account.username"),g={authenticated:null,events:c.events(a,b,"account"),hoodie:a,requests:{},userDoc:{},userDocPrefix:"org.couchdb.user",get username(){return f},set username(a){f=a,b.username=a}};Object.keys(d).forEach(function(a){"function"==typeof d[a]&&(b[a]=d[a].bind(null,g))}),a.on("remote:error:unauthenticated",e.reauthenticate.bind(null,g)),b.on("cleanup",c.config.clear),b.checkPasswordReset()["catch"](function(){}),b.username=f,b.bearerToken=c.config.get("_account.bearerToken"),a.account=b}},{"../../utils":79,"./api":43,"./helpers":44}],46:[function(a,b){(function(c){var d=a("../utils/promise"),e=b.exports=function(a){var b={online:!0,checkConnectionRequest:null,checkConnectionTimeout:null,hoodie:a};a.checkConnection=e.checkConnection.bind(null,b),a.isConnected=e.isConnected.bind(null,b),c.addEventListener("online",a.checkConnection,!1),c.addEventListener("offline",a.checkConnection,!1),setTimeout(a.checkConnection)};e.checkConnection=function(a){if(a.checkConnectionRequest)return a.checkConnectionRequest;var b="/?hoodieId="+a.hoodie.id();return c.clearTimeout(a.checkConnectionTimeout),a.checkConnectionRequest=a.hoodie.request("GET",b).then(e.handleConnection.bind(null,a,3e4,"reconnected",!0),e.handleConnection.bind(null,a,3e3,"disconnected",!1)),a.checkConnectionRequest},e.isConnected=function(a){return a&&a.online},e.handleConnection=function(a,b,f,g){return a.checkConnectionRequest=void 0,a.checkConnectionTimeout=c.setTimeout(e.checkConnection.bind(null,a),b),e.isConnected(a)!==g&&(a.hoodie.trigger(f),a.online=g),d[g?"resolve":"reject"]()}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/promise":82}],47:[function(a,b,c){var d=a("../utils"),e=d.generateId,f=d.config,c=b.exports=function(a){var b={id:f.get("_hoodieId")};b.id||(b.id=f.get("_account.ownerHash")),a.on("account:cleanup",c.unsetId.bind(null,b)),a.on("account:signin",function(a,d){c.setId(b,d)}),a.on("account:signin:anonymous",c.setId.bind(null,b)),a.id=c.id.bind(null,b)};c.id=function(a){return a.id||c.setId(a,e()),a.id},c.setId=function(a,b){a.id=b,f.set("_hoodieId",a.id)},c.unsetId=function(a){delete a.id,f.unset("_hoodieId")}},{"../utils":79}],48:[function(a,b,c){var d=a("../lib/store/remote"),e=a("extend"),c=b.exports=function(a){a.open=c.open.bind(null,a)};c.open=function(a,b,d){return d=d||{},e(d,{name:b}),c.hoodieRemoteStore(a,d)},c.hoodieRemoteStore=d},{"../lib/store/remote":71,extend:39}],49:[function(a,b,c){var d=a("../utils"),e=d.config,f=d.promise.rejectWith,c=b.exports=function(a){var b=a.open(a.account.db(),{connected:!0,prefix:"",since:c.sinceNrCallback,defaultObjectsToPush:a.store.changedObjects,knownObjects:a.store.index().map(function(a){var b=a.split(/\//);return{type:b[0],id:b[1]}})});b.connect=c.connect.bind(null,a,b.connect),b.trigger=c.trigger.bind(null,a),b.on=c.on.bind(null,a),b.unbind=c.unbind.bind(null,a),a.on("remote:connect",function(){a.on("store:idle",b.push)}),a.on("remote:disconnect",function(){a.unbind("store:idle",b.push)}),a.on("disconnected",b.disconnect),a.on("reconnected",b.connect),a.on("account:signup",b.connect),a.on("account:signup:anonymous",b.connect),a.on("account:signin",b.connect),a.on("account:signin:anonymous",b.connect),a.on("account:changeusername",b.connect),a.on("account:reauthenticated",b.connect),a.on("account:signout",b.disconnect),a.remote=b};c.connect=function(a,b){return a.account.hasAccount()?b(a.account.db()):f("User has no database to connect to")},c.trigger=function(a){var b=Array.prototype.slice.call(arguments,1);return b[0]="remote:"+b[0],a.trigger.apply(a,b)},c.on=function(a,b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.on(b,c)},c.unbind=function(a,b,c){return b=b.replace(/(^| )([^ ]+)/g,"$1remote:$2"),a.unbind(b,c)},c.sinceNrCallback=function(a){return a?e.set("_remote.since",a):e.get("_remote.since")||0}},{"../utils":79}],50:[function(a,b){(function(c){var d=a("extend"),e=a("../utils"),f=e.hoodiefyRequestErrorName,g=e.promise.defer,h=e.promise.rejectWith,i=b.exports=function(a){a.request=i.request.bind(null,a)},j="/_api";i.request=function(a,b,e,f){var h,k={type:b,dataType:"json"},l=g(),m=l.promise;f=f||{},a.account.bearerToken&&(k.headers={Authorization:"Bearer "+a.account.bearerToken}),/^http/.test(e)||(e=(a.baseUrl||"")+j+e),/^http/.test(e)&&(k.xhrFields={withCredentials:!0},k.crossDomain=!0),k.url=e,h=c.jQuery.ajax(d(k,f)).done(l.resolve).fail(l.reject);var n=m.then(null,i.handleRequestError.bind(null,a));return n.abort=h.abort,n},i.handleRequestError=function(a,b){var c;if("abort"===b.statusText)return h({name:"HoodieConnectionAbortError",message:"Request has been aborted"});try{c=i.parseErrorFromResponse(b)}catch(d){c=b&&b.responseText?b.responseText:{name:"HoodieConnectionError",message:"Could not connect to Hoodie server at {{url}}.",url:a.baseUrl||"/"}}return h(c)},i.HTTP_STATUS_ERROR_MAP={400:"HoodieRequestError",401:"HoodieUnauthorizedError",403:"HoodieRequestError",404:"HoodieNotFoundError",409:"HoodieConflictError",412:"HoodieConflictError",500:"HoodieServerError"},i.parseErrorFromResponse=function(a){var b=JSON.parse(a.responseText);return b.name=i.HTTP_STATUS_ERROR_MAP[a.status],b.name||(b.name=f(b.error)),b.status=a.status,b.message=b.reason||"",b.message=b.message.charAt(0).toUpperCase()+b.message.slice(1),delete b.error,delete b.reason,b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils":79,extend:39}],51:[function(a,b){(function(c){var d=a("../../utils"),e=d.promise,f=e.defer,g=d.localStorageWrapper,h=a("./helpers"),i=b.exports;i.index=function(a){var b,c,d,e,f;for(d=[],b=e=0,f=g.length();f>=0?f>e:e>f;b=f>=0?++e:--e)c=g.key(b),h.isSemanticKey(a,c)&&d.push(c);return d},i.changedObjects=function(a){var b,c,d,e,f,g,h;f=a.dirty,h=[];for(c in f)f.hasOwnProperty(c)&&(d=f[c],g=c.split("/"),e=g[0],b=g[1],d.type=e,d.id=b,h.push(d));return h},i.hasLocalChanges=function(a,b,d){if(!b)return!c.$.isEmptyObject(a.dirty);var e=[b,d].join("/");return a.dirty[e]?!0:h.hasLocalChanges(a,h.cache(a,b,d))},i.clear=function(a){var b,c,d,e;b=f();try{d=i.index(a),e=function(){var b,e,f;for(f=[],b=0,e=d.length;e>b;b++)c=d[b],h.isSemanticKey(a,c)&&f.push(g.removeItem(c));return f}.call(this),a.cachedObject={},h.clearChanged(a),b.resolve(),a.hoodie.store.trigger("clear")}catch(j){b.reject(j)}return b.promise},i.isBootstrapping=function(a){return a.bootstrapping},i.isPersistent=function(){return g.isPersistent}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":79,"./helpers":53}],52:[function(a,b,c){var d=a("./localstore"),c=b.exports;c.start=function(a){a.bootstrapping=!0,a.hoodie.store.trigger("bootstrap:start")},c.end=function(a){var b,c,e,f;for(a.bootstrapping=!1;a.queue.length>0;)b=a.queue.shift(),c=b[0],e=b[1],f=b[2],d[c].bind(d).apply(d,e).then(f.resolve,f.reject);a.hoodie.store.trigger("bootstrap:end")},c.abort=function(a,b){var c,d;for(a.bootstrapping=!1;a.queue.length>0;)c=a.queue.shift(),d=c[2],d.reject(b);a.hoodie.store.trigger("bootstrap:error",b)}},{"./localstore":55}],53:[function(a,b){(function(c){var d=a("extend"),e=a("../../utils"),f=e.promise,g=f.defer,h=e.localStorageWrapper,i=b.exports;i.cache=function(a,b,c,e,f){var g,j;if(void 0===e&&(e=!1),f=f||{},g=""+b+"/"+c,e){if(d(e,{type:b,id:c}),j=d({},e),delete j.type,delete j.id,h.setObject(g,j),f.remote)return i.clearChanged(a,b,c),a.cachedObject[g]=d(!0,{},e),a.cachedObject[g]}else{if(a.cachedObject[g]===!1)return!1;if(a.cachedObject[g])return d(!0,{},a.cachedObject[g]);if(g=""+b+"/"+c,e=h.getObject(g),!e)return i.clearChanged(a,b,c),a.cachedObject[g]=!1,!1;e.type=b,e.id=c}return i.isMarkedAsDeleted(a,e)?(i.markAsChanged(a,b,c,e,f),a.cachedObject[g]=!1,!1):(a.cachedObject[g]=d(!0,{},e),i.hasLocalChanges(a,e)?i.markAsChanged(a,b,c,a.cachedObject[g],f):i.clearChanged(a,b,c),d(!0,{},e))},i.markAsChanged=function(a,b,c,d,e){var f;e=e||{},f=""+b+"/"+c,a.dirty[f]=d,i.saveDirtyIds(a),e.silent||i.triggerDirtyAndIdleEvents(a)},i.clearChanged=function(a,b,d){var e;return b&&d?(e=""+b+"/"+d,delete a.dirty[e]):a.dirty={},i.saveDirtyIds(a),c.clearTimeout(a.dirtyTimeout)},i.markAllAsChanged=function(a){return a.hoodie.store.findAll().done(function(b){var c,d,e,f;for(e=0,f=b.length;f>e;e++)d=b[e],c=""+d.type+"/"+d.id,a.dirty[c]=d;i.saveDirtyIds(a),i.triggerDirtyAndIdleEvents(a)})},i.handleRemoteChange=function(a,b,c){"remove"===b?a.hoodie.store.remove(c.type,c.id,{remote:!0,update:c}):a.hoodie.store.save(c.type,c.id,c,{remote:!0})},i.handlePushedObject=function(a,b){i.triggerEvents(a,"sync",b),b._deleted?a.hoodie.store.remove(b.type,b.id,{remote:!0,silent:!0}):a.hoodie.store.save(b.type,b.id,b,{remote:!0,silent:!0})},i.saveDirtyIds=function(a){if(c.$.isEmptyObject(a.dirty))h.removeItem("_dirty");else{var b=Object.keys(a.dirty);h.setItem("_dirty",b.join(","))}},i.now=function(){return JSON.stringify(new Date).replace(/['"]/g,"")},i.SEMANTIC_ID_PATTERN=new RegExp(/^[a-z$][a-z0-9-]+\/[a-z0-9]+$/),i.isSemanticKey=function(a,b){return i.SEMANTIC_ID_PATTERN.test(b)},i.hasLocalChanges=function(a,b){return b.updatedAt?b._syncedAt?b._syncedAt<b.updatedAt:!0:!1},i.isMarkedAsDeleted=function(a,b){return b._deleted===!0},i.triggerEvents=function(a,b,c,e){a.hoodie.store.trigger(b,d(!0,{},c),e),a.hoodie.store.trigger(c.type+":"+b,d(!0,{},c),e),a.hoodie.store.trigger(b+":"+c.type,d(!0,{},c),e),"new"!==b&&(a.hoodie.store.trigger(c.type+":"+c.id+":"+b,d(!0,{},c),e),a.hoodie.store.trigger(b+":"+c.type+":"+c.id,d(!0,{},c),e)),"sync"!==b&&(a.hoodie.store.trigger("change",b,d(!0,{},c),e),a.hoodie.store.trigger(c.type+":change",b,d(!0,{},c),e),a.hoodie.store.trigger("change:"+c.type,b,d(!0,{},c),e),"new"!==b&&(a.hoodie.store.trigger(c.type+":"+c.id+":change",b,d(!0,{},c),e),a.hoodie.store.trigger("change:"+c.type+":"+c.id,b,d(!0,{},c),e)))},i.triggerDirtyAndIdleEvents=function(a){a.hoodie.store.trigger("dirty"),c.clearTimeout(a.dirtyTimeout),a.dirtyTimeout=c.setTimeout(function(){a.hoodie.store.trigger("idle",a.hoodie.store.changedObjects())},a.idleTimeout)},i.enqueue=function(a,b,c){var d=g();return a.queue.push([b,c,d]),d.promise},i.moveData=function(a){var b,c=[];a.hoodie.store.findAll().done(function(d){c=d,c.length&&(b=a.hoodie.id(),a.hoodie.once("account:signin",function(d,e){c.forEach(function(c){c.createdBy===b&&(c.createdBy=e),c=i.cache(a,c.type,c.id,c),i.markAsChanged(a.object.type,c.id,c,{silent:!0})}),i.triggerDirtyAndIdleEvents(a)}))})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils":79,extend:39}],54:[function(a,b,c){var d=a("../../lib/store/api"),e=a("../../lib/error/object_type"),f=a("../../lib/error/object_id"),g=a("./api"),h=a("./bootstrap"),i=a("./helpers"),j=a("./localstore"),k=a("../../utils").localStorageWrapper,c=b.exports=function(a){var b={bootstrapping:!1,cachedObject:{},dirtyTimeout:void 0,dirty:{},hoodie:a,queue:[],idleTimeout:2e3},d=c.hoodieStoreApi(a,{validate:c.validate,backend:{save:c.localStore.save.bind(null,b),find:c.localStore.find.bind(null,b),findAll:c.localStore.findAll.bind(null,b),remove:c.localStore.remove.bind(null,b),removeAll:c.localStore.removeAll.bind(null,b)}});Object.keys(g).forEach(function(a){"function"==typeof g[a]&&(d[a]=g[a].bind(null,b))}),a.on("account:signup",i.markAllAsChanged.bind(null,b)),a.on("account:movedata",i.moveData.bind(null,b)),a.on("account:cleanup",g.clear.bind(null,b)),a.on("remote:bootstrap:start",h.start.bind(null,b)),a.on("remote:bootstrap:end",h.end.bind(null,b)),a.on("remote:bootstrap:error",h.abort.bind(null,b)),a.on("remote:change",i.handleRemoteChange.bind(null,b)),a.on("remote:push",i.handlePushedObject.bind(null,b)),a.store=d,c.bootstrapChangedObjects(b)};c.bootstrapChangedObjects=function(a){var b=k.getItem("_dirty");if(b){b=b.split(",");for(var c=0;c<b.length;c++){var d=b[c].split("/");i.cache(a,d[0],d[1])}}},c.validate=function(a){if(e.isInvalid(a.type))return new e({type:a.type});if(a.id)return f.isInvalid(a.id)?new f({id:a.id}):void 0},c.hoodieStoreApi=d,c.localStore=j},{"../../lib/error/object_id":61,"../../lib/error/object_type":62,"../../lib/store/api":67,"../../utils":79,"./api":51,"./bootstrap":52,"./helpers":53,"./localstore":55}],55:[function(a,b,c){var d=a("./helpers"),e=a("../../utils"),f=e.generateId,g=e.localStorageWrapper,h=e.promise,i=h.defer,j=h.rejectWith,k=h.resolveWith,l=h.Promise;c.save=function(a,b,c){var e,g,h,j,k,l;if(c=c||{},a.hoodie.store.isBootstrapping(a)&&!c.remote)return d.enqueue(a,"save",arguments);if(b.id?(e=d.cache(a,b.type,b.id),k="object"!=typeof e):(k=!0,b.id=f()),k?b.createdBy=b.createdBy||a.hoodie.id():e.createdBy&&(b.createdBy=e.createdBy),!k)for(l in e)if(!b.hasOwnProperty(l))switch(l.charAt(0)){case"_":c.remote&&(b[l]=e[l]);break;case"$":c.remote||(b[l]=e[l])}c.remote?b._syncedAt=d.now(a):c.silent||(b.updatedAt=d.now(a),b.createdAt=b.createdAt||b.updatedAt),c.local?b._$local=!0:delete b._$local,g=i();try{b=d.cache(a,b.type,b.id,b,c),g.resolve(b,k),j=k?"add":"update",c.silent||d.triggerEvents(a,j,b,c)}catch(m){h=m,g.reject(h.toString())}return g.promise},c.find=function(a,b,c){var e,f;if(a.hoodie.store.isBootstrapping())return d.enqueue(a,"find",arguments);try{return f=d.cache(a,b,c),f?k(f):j({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found',type:b,id:c})}catch(g){return e=g,j(e)}},c.findAll=function(a,b){var c,e,f,g,h,j,k,l,m;if(null==b&&(b=function(){return!0}),a.hoodie.store.isBootstrapping())return d.enqueue(a,"findAll",arguments);j=a.hoodie.store.index(),"string"==typeof b&&(m=b,b=function(a){return a.type===m}),e=i();try{l=function(){var e,f,i,l;for(l=[],e=0,f=j.length;f>e;e++)h=j[e],d.isSemanticKey(a,h)&&(i=h.split("/"),c=i[0],g=i[1],k=d.cache(a,c,g),k&&b(k)&&l.push(k));return l}.call(this),l.sort(function(a,b){return a.createdAt>b.createdAt?-1:a.createdAt<b.createdAt?1:0}),e.resolve(l)}catch(n){f=n,e.reject(f)}return e.promise},c.remove=function(a,b,c,e){var f,h,i;return e=e||{},a.hoodie.store.isBootstrapping()&&!e.remote?d.enqueue(a,"remove",arguments):(f=b+"/"+c,h=d.cache(a,b,c),e.update&&(h=e.update,delete e.update),e.remote&&(g.removeItem(f),i=a.cachedObject[f]&&d.isMarkedAsDeleted(a,a.cachedObject[f]),a.cachedObject[f]=!1,d.clearChanged(a,b,c),h)?(i||d.triggerEvents(a,"remove",h,e),k(h)):h?(h._syncedAt?(h._deleted=!0,d.cache(a,b,c,h)):(f=b+"/"+c,g.removeItem(f),a.cachedObject[f]=!1,d.clearChanged(a,b,c)),d.triggerEvents(a,"remove",h,e),k(h)):j({name:"HoodieNotFoundError",message:'"{{type}}" with id "{{id}}" could not be found',type:b,id:c}))},c.removeAll=function(a,b,c){return a.hoodie.store.findAll(b).then(function(b){var d;return d=b.map(function(b){return a.hoodie.store.remove(b.type,b.id,c)}),l.all(d)})}},{"../../utils":79,"./helpers":53}],56:[function(a,b,c){var d=a("extend"),e=a("./helpers"),f=a("../../utils"),g=f.promise.defer,c=b.exports;c.start=function(a,b,d){var f;return a.hoodie.account.hasAccount()?a.hoodie.store.add("$"+b,d).then(e.handleNewTask.bind(null,a)):(f=g(),a.hoodie.account.anonymousSignUp().then(function(){return c.start(a,b,d).progress(f.notify)}).done(f.resolve).fail(f.reject),f.promise)},c.abort=function(a,b,c){return a.hoodie.store.update("$"+b,c,{abortedAt:e.now(a)}).then(e.handleAbortedTaskObject.bind(null,a))},c.restart=function(a,b,e,f){var g=function(b){return d(b,f),delete b.$error,delete b.$processedAt,delete b.abortedAt,c.start(a,b.type,b)};return c.abort(a,b,e).then(g)},c.abortAll=function(a,b){return e.findAll(a,b).then(e.abortTaskObjects.bind(null,a))},c.restartAll=function(a,b,c){return"object"==typeof b&&(c=b),e.findAll(a,b).then(function(b){e.restartTaskObjects(a,b,c)})}},{"../../utils":79,"./helpers":57,extend:39}],57:[function(a,b,c){var d=a("../../lib"),e=d.error.error,f=a("../../utils"),g=f.promise.defer,h=a("extend"),c=b.exports;c.handleNewTask=function(a,b){var c=g(),d=a.hoodie.store(b.type,b.id);return d.on("sync",function(a){a.type=a.type.substr(1),c.notify(a)}),d.on("remove",function(a){return a.type=a.type.substr(1),a.$processedAt?c.resolve(a):void c.reject(new e({message:"Task has been aborted",task:a}))}),d.on("update",function(b){var d=b.$error;b.$error&&(b.type=b.type.substr(1),delete b.$error,d.object=b,d.message=d.message||"Something went wrong",c.reject(new e(d)),a.hoodie.store.remove("$"+b.type,b.id))}),c.promise},c.handleAbortedTaskObject=function(a,b){var c,d=b.type,e=b.id,f=a.hoodie.store.remove(d,e);return b._rev?(c=g(),a.hoodie.once("store:sync:"+d+":"+e,c.resolve),f.fail(c.reject),c.promise):f},c.handleStoreChange=function(a,b,d,e){"$"===d.type[0]&&(d.type=d.type.substr(1),c.triggerEvents(a,b,d,e))},c.findAll=function(a,b){var c,d="$";return b&&(d+=b),c=function(a){return 0===a.type.indexOf(d)},a.hoodie.store.findAll(c)},c.abortTaskObjects=function(a,b){return b.map(function(b){return a.hoodie.task.abort(b.type.substr(1),b.id)})},c.restartTaskObjects=function(a,b,c){return b.map(function(b){return a.hoodie.task.restart(b.type.substr(1),b.id,c)})},c.triggerEvents=function(a,b,c,d){var e;return"add"===b&&(b="start"),"remove"===b&&c.abortedAt&&(b="abort"),"remove"===b&&c.$processedAt&&!c.$error&&(b="success"),"update"===b&&c.$error?(b="error",e=c.$error,delete c.$error,a.events.trigger("error",e,c,d),a.events.trigger(c.type+":error",e,c,d),a.events.trigger(c.type+":"+c.id+":error",e,c,d),d=h({},d,{error:e}),a.events.trigger("change","error",c,d),a.events.trigger(c.type+":change","error",c,d),void a.events.trigger(c.type+":"+c.id+":change","error",c,d)):void(("start"===b||"abort"===b||"success"===b)&&(a.events.trigger(b,c,d),a.events.trigger(c.type+":"+b,c,d),"start"!==b&&a.events.trigger(c.type+":"+c.id+":"+b,c,d),a.events.trigger("change",b,c,d),a.events.trigger(c.type+":change",b,c,d),"start"!==b&&a.events.trigger(c.type+":"+c.id+":change",b,c,d)))},c.now=function(){return JSON.stringify(new Date).replace(/['"]/g,"")}},{"../../lib":64,"../../utils":79,extend:39}],58:[function(a,b,c){var d=a("../../lib"),e=a("../../utils"),f=a("./api"),g=a("./helpers"),c=b.exports=function(a){var b,d=function(){return b.apply(null,arguments)};b=c.scopedTask.bind(null,a,d);var h={events:e.events(a,d,"task"),hoodie:a};Object.keys(f).forEach(function(a){"function"==typeof f[a]&&(d[a]=f[a].bind(null,h))}),a.task=d,a.on("store:change",g.handleStoreChange.bind(null,h))};c.scopedTask=function(a,b,c,e){return d.task.scoped(a,b,{type:c,id:e})}},{"../../lib":64,"../../utils":79,"./api":56,"./helpers":57}],59:[function(a,b){var c=a("extend");b.exports=function(){function a(a){"string"==typeof a&&(a={message:a}),a.message||(a.message="Something went wrong"),a.name||(a.name="HoodieError"),a.message=a.message.replace(b,function(b){var c=b.match(d)[0];return a[c]}),c(this,a)}var b=/\{\{\s*\w+\s*\}\}/g,d=/\w+/;return a.prototype=new Error,a.prototype.constructor=a,a}()},{extend:39}],60:[function(a,b){b.exports={error:a("./error"),objectId:a("./object_id"),objectType:a("./object_type")}},{"./error":59,"./object_id":61,"./object_type":62}],61:[function(a,b){var c=a("./error"),d=a("./validation");b.exports=function(){function a(a){return a.name="HoodieObjectIdError",a.message='"{{id}}" is invalid object id. {{rules}}.',new c(a)}var b=/^[a-z0-9\-]+$/;return a.isValid=d.isValid.bind(null,b),a.isInvalid=d.isInvalid.bind(null,b),a.prototype.rules="Lowercase letters, numbers and dashes allowed only. Must start with a letter",a}()},{"./error":59,"./validation":63}],62:[function(a,b){var c=a("./error"),d=a("./validation"),e="lowercase letters, numbers and dashes allowed only. Must start with a letter";b.exports=function(){function a(a){return a.name="HoodieObjectTypeError",a.message='"{{type}}" is invalid object type. {{rules}}.',a.rules=e,new c(a)}var b=/^[a-z$][a-z0-9-]+$/;return a.isValid=d.isValid.bind(null,b),a.isInvalid=d.isInvalid.bind(null,b),a}()},{"./error":59,"./validation":63}],63:[function(a,b,c){c.isValid=function(a,b,c){return(c||a).test(b||"")},c.isInvalid=function(){return!c.isValid.apply(null,arguments)}},{}],64:[function(a,b){b.exports={error:a("./error"),store:a("./store"),task:a("./task")}},{"./error":60,"./store":68,"./task":74}],65:[function(a,b,c){var d=a("extend"),e=a("./helpers"),f=a("../../../utils"),g=f.promise,h=g.rejectWith,i=g.resolveWith,j=g.isPromise,k=g.Promise;c.save=function(a,b,c,f,g){g=g?d(!0,{},g):{};var i=d(!0,{},f,{type:b,id:c}),j=a.validate(i,g||{});return j?h(j):e.decoratePromise(a,a.backend.save(i,g||{}))},c.add=function(a,b,d,e){return void 0===d&&(d={}),e=e||{},d.id?c.find(a,b,d.id).then(function(a){return h({name:"HoodieConflictError",message:'"{{type}}" with id "{{id}}" already exists',type:a.type,id:a.id})})["catch"](function(f){if("HoodieNotFoundError"===f.name)return c.save(a,b,d.id,d,e);throw f}):c.save(a,b,d.id,d,e)},c.find=function(a,b,c){return e.decoratePromise(a,a.backend.find(b,c))},c.findOrAdd=function(a,b,f,g){function h(){var e;return e=d(!0,{id:f},g),c.add(a,b,e)}null===g&&(g={});var i=c.find(a,b,f).then(null,h);return e.decoratePromise(a,i)},c.findAll=function(a,b,c){return e.decoratePromise(a,a.backend.findAll(b,c))},c.update=function(a,b,f,g,h){function j(e){var j,k,l;return k=d(!0,{},e),"function"==typeof g&&(g=g(k)),g?(j=function(){var a=[];for(var b in g)if(g.hasOwnProperty(b)){if(l=g[b],e[b]===l)continue;k[b]=l,a.push(b)}return a}(),j.length||h?c.save(a,b,f,k,h):i(k)):i(e)}var k=c.find(a,b,f).then(j);return e.decoratePromise(a,k)},c.updateOrAdd=function(a,b,f,g,h){function i(){var e=d(!0,{},g,{id:f});return c.add(a,b,e,h)}var j=c.update(a,b,f,g,h).then(null,i);return e.decoratePromise(a,j)},c.updateAll=function(a,b,d,f){var g;switch(f=f||{},!0){case"string"==typeof b:g=c.findAll(a,b);break;case j(b):g=b;break;case $.isArray(b):g=i(b);break;default:g=c.findAll(a),f=d,d=b}return g=g.then(function(b){var e;return $.isArray(b)||(b=[b]),e=b.map(function(b){return c.update(a,b.type,b.id,d,f)}),k.all(e)}),e.decoratePromise(a,g)},c.remove=function(a,b,c,d){return e.decoratePromise(a,a.backend.remove(b,c,d||{}))},c.removeAll=function(a,b,c){return e.decoratePromise(a,a.backend.removeAll(b,c||{}))},c.decoratePromises=function(a,b){return d(a.promiseApi,b)}},{"../../../utils":79,"./helpers":66,extend:39}],66:[function(a,b,c){var d=a("extend"),e=a("../../error"),f=e.error,g=e.objectType,h=e.objectId,c=b.exports;c.decoratePromise=function(a,b){return d(b,a.promiseApi)},c.validIdOrTypePattern=/^[^\/]+$/,c.validIdOrTypeRules="/ not allowed",c.defaultValidate=function(a){if(!a)return new f({name:"InvalidObjectError",message:"No object passed."});if(g.isInvalid(a.type,c.validIdOrTypePattern))return new g({type:a.type,rules:c.validIdOrTypeRules});if(a.id)return h.isInvalid(a.id,c.validIdOrTypePattern)?new h({id:a.id,rules:c.validIdOrTypeRules}):void 0}},{"../../error":60,extend:39}],67:[function(a,b){var c=a("../scoped"),d=a("extend"),e=a("../../../utils"),f=a("./helpers"),g=a("./api");b.exports=function(a,b){var h={backend:{},hoodie:a,storeName:b.name||"store",promiseApi:{hoodie:a}},i=function(e,f){var g=d(!0,{type:e,id:f},b);return c(a,i,g)};if(h.events=e.events(a,i,h.storeName),i.validate=h.validate=f.defaultValidate.bind(null),"function"==typeof b.validate&&(i.validate=h.validate=b.validate),!b.backend)throw new Error("options.backend must be passed");return["save","find","findAll","remove","removeAll"].forEach(function(a){if(!b.backend[a])throw new Error("options.backend."+a+" must be passed.");h.backend[a]=b.backend[a]}),Object.keys(g).forEach(function(a){"function"==typeof g[a]&&(i[a]=g[a].bind(null,h))}),i}},{"../../../utils":79,"../scoped":73,"./api":65,"./helpers":66,extend:39}],68:[function(a,b){b.exports={api:a("./api"),remote:a("./remote"),scoped:a("./scoped")}},{"./api":67,"./remote":71,"./scoped":73}],69:[function(a,b){(function(c){var d=a("extend"),e=a("../../../utils"),f=e.promise.defer,g=e.promise.resolveWith,h=e.promise.resolve,i=a("./helpers"),j=b.exports;j.request=function(a,b,c,d){return d=d||{},a.remoteName&&(c="/"+encodeURIComponent(a.remoteName)+c),a.baseUrl&&(c=""+a.baseUrl+c),d.contentType=d.contentType||"application/json",("POST"===b||"PUT"===b)&&(d.dataType=d.dataType||"json",d.processData=d.processData||!1,d.data=JSON.stringify(d.data)),a.hoodie.request(b,c,d)},j.isKnownObject=function(a,b){var c=""+b.type+"/"+b.id;return void 0!==a.knownObjects[c]?a.knownObjects[c]:void 0},j.markAsKnownObject=function(a,b){var c=""+b.type+"/"+b.id;return a.knownObjects[c]=1,a.knownObjects[c]};var k;j.connect=function(a,b){return a.connected?k.promise:(k=f(),b&&(a.remoteName=b),a.connected=!0,a.remote.trigger("connect"),a.remote.bootstrap().then(function(){return a.remote.push()}).then(k.resolve,k.reject),k.promise)},j.disconnect=function(a){return a.connected=!1,a.remote.trigger("disconnect"),a.pullRequest&&a.pullRequest.abort(),a.pushRequest&&a.pushRequest.abort(),k=void 0,h()},j.isConnected=function(a){return a.connected},j.getSinceNr=function(a){return"function"==typeof a.since?a.since():a.since},j.bootstrap=function(a){return a.isBootstrapping=!0,a.remote.trigger("bootstrap:start"),a.remote.pull().done(i.handleBootstrapSuccess.bind(null,a)).fail(i.handleBootstrapError.bind(null,a))},j.pull=function(a){return a.pullRequest=a.remote.request("GET",i.pullUrl(a)),a.remote.isConnected()&&(c.clearTimeout(a.pullRequestTimeout),a.pullRequestTimeout=c.setTimeout(a.restartPullRequest,25e3)),a.pullRequest.done(i.handlePullSuccess.bind(null,a)).fail(i.handlePullError.bind(null,a))},j.push=function(a,b){var c,e=[];if($.isArray(b)||(b=i.defaultObjectsToPush(a)),0===b.length)return g([]);b=b.map(function(a){return d(!0,{},a)}),e=[];for(var f=0;f<b.length;f++)c=b[f],i.addRevisionTo(a,c),a.remote.markAsKnownObject(c),c=i.parseForRemote(a,c),e.push(c),a.pushedObjectRevisions[c._rev]=1;return a.pushRequest=a.remote.request("POST","/_bulk_docs",{data:{docs:e,new_edits:!1}}),a.pushRequest.done(function(){for(var c=0;c<b.length;c++)delete b[c]._revisions,a.remote.trigger("push",b[c])}),a.pushRequest},j.sync=function(a,b){return a.remote.push(b).then(a.remote.pull)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../utils":79,"./helpers":70,extend:39}],70:[function(a,b){(function(c){var d=a("extend"),e=a("../../../utils"),f=e.generateId,g=b.exports;g.VALID_SPECIAL_ATTRIBUTES=["_id","_rev","_deleted","_revisions","_attachments"],g.defaultObjectsToPush=function(a){return a.options&&a.options.defaultObjectsToPush?c.$.isArray(a.options.defaultObjectsToPush)?a.options.defaultObjectsToPush:a.options.defaultObjectsToPush():[]},g.setSinceNr=function(a,b){return"function"==typeof a.since?a.since(b):(a.since=b,a.since)},g.parseForRemote=function(a,b){var c,e;e=d({},b);for(c in e)if(e.hasOwnProperty(c)){if(-1!==g.VALID_SPECIAL_ATTRIBUTES.indexOf(c))continue;if(!/^_/.test(c))continue;delete e[c]}return e._id=""+e.type+"/"+e.id,a.prefix&&(e._id=""+a.prefix+e._id),delete e.id,e},g.parseFromRemote=function(a,b){var c,d;return c=b._id||b.id,delete b._id,a.prefix&&(c=c.replace(a.remotePrefixPattern,"")),d=c.match(/([^\/]+)\/(.*)/),b.type=d[1],b.id=d[2],b},g.parseAllFromRemote=function(a,b){return b.map(g.parseFromRemote.bind(null,a))},g.addRevisionTo=function(a,b){var c,d,e,f;return b._rev&&(f=b._rev.split(/-/),d=f[0],c=f[1]),d=parseInt(d,10)||0,e=g.generateNewRevisionId(a),b._$local&&(e+="-local"),b._rev=""+(d+1)+"-"+e,b._revisions={start:1,ids:[e]},c?(b._revisions.start+=d,b._revisions.ids.push(c)):void 0},g.generateNewRevisionId=function(){return f(9)},g.mapDocsFromFindAll=function(a,b){return b.rows.map(function(a){return a.doc})},g.pullUrl=function(a){var b=a.remote.getSinceNr();return a.remote.isConnected()&&!a.isBootstrapping?"/_changes?include_docs=true&since="+b+"&heartbeat=10000&feed=longpoll":"/_changes?include_docs=true&since="+b
},g.restartPullRequest=function(a){a.pullRequest&&a.pullRequest.abort()},g.handlePullSuccess=function(a,b){return g.setSinceNr(a,b.last_seq),g.handlePullResults(a,b.results),a.remote.isConnected()?a.remote.pull():void 0},g.handlePullError=function(a,b,d){if(a.remote.isConnected())switch(b.status){case 401:return a.remote.trigger("error:unauthenticated",d),a.remote.disconnect();case 404:return c.setTimeout(a.remote.pull,3e3);case 500:return a.remote.trigger("error:server",d),c.setTimeout(a.remote.pull,3e3),a.hoodie.checkConnection();default:return"abort"===b.statusText?a.remote.pull():(c.setTimeout(a.remote.pull,3e3),a.hoodie.checkConnection())}},g.handleBootstrapSuccess=function(a){a.isBootstrapping=!1,a.remote.trigger("bootstrap:end")},g.handleBootstrapError=function(a,b){a.isBootstrapping=!1,a.remote.trigger("bootstrap:error",b)},g.handlePullResults=function(a,b){for(var c,d,e,f=a.remote,h=0;h<b.length;h++)if(c=b[h].doc,!(a.prefix&&0!==c._id.indexOf(a.prefix)||a.pushedObjectRevisions[c._rev])){if(e=g.parseFromRemote(a,c),e._deleted){if(!a.remote.isKnownObject(e))continue;d="remove",f.isKnownObject(e)}else f.isKnownObject(e)?d="update":(d="add",f.markAsKnownObject(e));f.trigger(d,e),f.trigger(e.type+":"+d,e),f.trigger(e.type+":"+e.id+":"+d,e),f.trigger("change",d,e),f.trigger(e.type+":change",d,e),f.trigger(e.type+":"+e.id+":change",d,e),f.trigger(d+":"+e.type,e),f.trigger(d+":"+e.type+":"+e.id,e),f.trigger("change:"+e.type,d,e),f.trigger("change:"+e.type+":"+e.id,d,e)}a.pushedObjectRevisions={}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../utils":79,extend:39}],71:[function(a,b){var c=a("../api"),d=a("./remotestore"),e=a("./api");b.exports=function(a,b){var f={connected:!1,prefix:"",baseUrl:void 0},g={get baseUrl(){return f.baseUrl},set baseUrl(a){f.baseUrl=a,h.baseUrl=a},get connected(){return f.connected},set connected(a){f.connected=a,h.connected=a},get prefix(){return f.prefix},set prefix(a){f.prefix=a,h.prefix=a},remoteName:null,remotePrefixPattern:new RegExp("^"),since:b.since||0,isBootstrapping:!1,pullRequest:void 0,pullRequestTimeout:void 0,pushRequest:void 0,pushedObjectRevisions:{},knownObjects:{},options:b,hoodie:a},h=c(a,{name:b.name,backend:{save:d.save.bind(null,g),find:d.find.bind(null,g),findAll:d.findAll.bind(null,g),remove:d.remove.bind(null,g),removeAll:d.removeAll.bind(null,g)}});if(void 0!==b.name&&(g.remoteName=b.name),void 0!==b.prefix&&(g.prefix=b.prefix,g.remotePrefixPattern=new RegExp("^"+g.prefix)),null!==b.baseUrl&&(g.baseUrl=b.baseUrl),Object.keys(e).forEach(function(a){"function"==typeof e[a]&&(h[a]=e[a].bind(null,g))}),b.knownObjects)for(var i=0;i<b.knownObjects.length;i++)h.markAsKnownObject({type:b.knownObjects[i].type,id:b.knownObjects[i].id});return g.remote=h,h}},{"../api":67,"./api":69,"./remotestore":72}],72:[function(a,b,c){var d=a("../../../utils"),e=d.generateId,f=a("./helpers"),c=b.exports;c.find=function(a,b,c){var d;return d=b+"/"+c,a.prefix&&(d=a.prefix+d),d="/"+encodeURIComponent(d),a.remote.request("GET",d).then(f.parseFromRemote.bind(null,a))},c.findAll=function(a,b){var c,d,e;switch(d="/_all_docs?include_docs=true",!0){case void 0!==b&&""!==a.prefix:e=a.prefix+b+"/";break;case void 0!==b:e=b+"/";break;case""!==a.prefix:e=a.prefix;break;default:e=""}return e&&(c=e.replace(/.$/,function(a){var b;return b=a.charCodeAt(0),String.fromCharCode(b+1)}),d=d+'&startkey="'+encodeURIComponent(e)+'"&endkey="'+encodeURIComponent(c)+'"'),a.remote.request("GET",d).then(f.mapDocsFromFindAll.bind(null,a)).then(f.parseAllFromRemote.bind(null,a))},c.save=function(a,b){var c,d;return b.id||(b.id=e()),b.createdBy=b.createdBy||a.hoodie.id(),b.updatedAt=(new Date).toJSON(),b.createdAt=b.createdAt||b.updatedAt,c=f.parseForRemote(a,b),d="/"+encodeURIComponent(c._id),a.remote.request("PUT",d,{data:c}).then(function(a){return b._rev=a.rev,b})},c.remove=function(a,b,c){return a.remote.update(b,c,{_deleted:!0})},c.removeAll=function(a,b){return a.remote.updateAll(b,{_deleted:!0})}},{"../../../utils":79,"./helpers":70}],73:[function(a,b,c){var d=a("../../utils"),c=b.exports=function(a,b,e){var f={},g=e.id,h=e.name||"store",i=e.type;return d.events(a,f,[h,i,g].join(":").replace(/:$/,"")),f.decoratePromises=b.decoratePromises,f.validate=b.validate,g?(["save","find","update","remove"].forEach(function(a){f[a]=c[a].bind(null,b,i,g)}),f):(["save","add","find","findOrAdd","findAll","update","updateAll","remove","removeAll"].forEach(function(a){f[a]=c[a].bind(null,b,i)}),f)};c.save=function(a,b,c,d,e){return a.save(b,c,d,e)},c.add=function(a,b,c,d){return a.add(b,c,d)},c.find=function(a,b,c){return a.find(b,c)},c.findOrAdd=function(a,b,c,d){return a.findOrAdd(b,c,d)},c.findAll=function(a,b,c){return a.findAll(b,c)},c.update=function(a,b,c,d,e){return a.update(b,c,d,e)},c.updateAll=function(a,b,c,d){return a.updateAll(b,c,d)},c.remove=function(a,b,c,d){return a.remove(b,c,d)},c.removeAll=function(a,b,c){return a.removeAll(b,c)}},{"../../utils":79}],74:[function(a,b){b.exports={scoped:a("./scoped")}},{"./scoped":75}],75:[function(a,b,c){var d=a("../../utils"),c=b.exports=function(a,b,e){var f={},g=e.id,h=e.type;return d.events(a,f,["task",h,g].join(":").replace(/:$/,"")),g?(["abort","restart"].forEach(function(a){f[a]=c[a].bind(null,b,h,g)}),f):(["start","abort","restart","abortAll","restartAll"].forEach(function(a){f[a]=c[a].bind(null,b,h)}),f)};c.start=function(a,b,c){return a.start(b,c)},c.abort=function(a,b,c){return a.abort(b,c)},c.restart=function(a,b,c,d){return a.restart(b,c,d)},c.abortAll=function(a,b){return a.abortAll(b)},c.restartAll=function(a,b,c){return a.restartAll(b,c)}},{"../../utils":79}],76:[function(a,b,c){var d=a("../utils/local_storage_wrapper")(),e=a("extend"),c=b.exports=function(a){a=a||"_hoodie_config";var b={get:d.getObject.bind(null,a),set:d.setObject.bind(null,a),remove:d.removeItem.bind(null,a)},e=b.get()||{},f={config:e,store:b};return{set:c.set.bind(null,f),get:c.get.bind(null,f),clear:c.clear.bind(null,f),unset:c.unset.bind(null,f)}};c.set=function(a,b,c){a.config[b]=c,a.store.set(a.config)},c.get=function(a,b){return b?a.config[b]:e({},a.config)},c.clear=function(a){return a.config={},a.store.remove()},c.unset=function(a,b){delete a.config[b],a.store.set(a.config)}},{"../utils/local_storage_wrapper":80,extend:39}],77:[function(a,b,c){var d=a("jqevents"),e=a("extend"),c=b.exports=function(a,b,f){if(b&&f)return c.scopedEventEmitter.apply(null,arguments);var g=d.create();return g.one=g.once,g.bind=g.on,g.unbind=g.off,g.trigger=g.emit=function(a){return function(){try{a.apply(g,arguments)}catch(b){setTimeout(function(){throw b})}}}(g.emit),e(a,g),g};c.METHODS=["on","off","one","trigger","bind","unbind"];var f=/(^|\s)/g;c.scopedEventEmitter=function(a,b,d){var g={};return c.METHODS.forEach(function(b){g[b]=function(){var c=[].slice.call(arguments);c[0]=c[0].replace(f,"$1"+d+":"),a[b].apply(a,c)}}),e(b,g),g}},{extend:39,jqevents:41}],78:[function(a,b,c){var c=b.exports=function(a){return a=a||"0123456789abcdefghijklmnopqrstuvwxyz".split(""),c.generateId.bind(null,a)};c.generateId=function(a,b){var c="",d=a.length;void 0===b&&(b=7);for(var e=0;b>e;e++){var f=Math.random()*d,g=a[Math.floor(f)];c+=String(g).charAt(0)}return c}},{}],79:[function(a,b){b.exports={config:a("./config")(),events:a("./events"),generateId:a("./generate_id")(),localStorageWrapper:a("./local_storage_wrapper")(),promise:a("./promise")}},{"./config":76,"./events":77,"./generate_id":78,"./local_storage_wrapper":80,"./promise":82}],80:[function(a,b){(function(a){var c=b.exports=function(){return c.hasLocalStorage()?c.createWrapper(a.localStorage,!0):c.createWrapper(c.localStub,!1)};c.createWrapper=function(a,b){return{getItem:a.getItem.bind(a),setItem:a.setItem.bind(a),removeItem:a.removeItem.bind(a),key:a.key.bind(a),isPersistent:b,length:function(){return a.length},setObject:c.setObject.bind(null,a),getObject:c.getObject.bind(null,a)}};var d=function(){return null};c.localStub={getItem:d,setItem:d,removeItem:d,key:d,length:0},c.setObject=function(b,c,d){return"object"!=typeof d?b.setItem(c,d):b.setItem(c,a.JSON.stringify(d))},c.getObject=function(b,c){var d=b.getItem(c);if(!d)return null;try{return a.JSON.parse(d)}catch(e){return d}},c.hasLocalStorage=function(){try{if(!a.localStorage)return!1;if(a.localStorage.setItem("Storage-Test","1"),"1"!==a.localStorage.getItem("Storage-Test"))return!1;a.localStorage.removeItem("Storage-Test")}catch(b){return!1}return!0}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],81:[function(a,b){function c(a){function b(a,b){return b?function(){var c=b.apply(a,arguments);return c&&c._progressCallbacks&&a._progressCallbacks&&(c._progressCallbacks=c._progressCallbacks.concat(a._progressCallbacks)),c}:null}return a._isHoodiePromise?a:(a._isHoodiePromise=!0,a.done=function(a){return this.then(a),this},a.fail=function(a){return this.then(null,a),this},a.always=function(a){return this.then(a,a),this},a.progress=function(a){return this._progressCallbacks&&this._progressCallbacks.push(a),this},a.then=function(e,f){return a=d.prototype.then.call(this,b(this,e),b(this,f)),c(a),a._progressCallbacks=this._progressCallbacks,a},void(a["catch"]=function(b){return a=d.prototype["catch"].call(this,b),c(a),a}))}var d=a("./promise");b.exports=function(){var a={};return a.promise=new d(function(b,c){a.resolve=function(){a.notify=function(){},b.apply(null,arguments)},a.reject=function(){a.notify=function(){},c.apply(null,arguments)}}),c(a.promise),a.promise._progressCallbacks=[],a.notify=function(){var b=Array.prototype.slice.call(arguments);a.promise._progressCallbacks.forEach(function(a){a.apply(null,b)})},a}},{"./promise":84}],82:[function(a,b){b.exports={defer:a("./defer"),isPromise:a("./is_promise"),rejectWith:a("./reject_with"),reject:a("./reject"),resolveWith:a("./resolve_with"),resolve:a("./resolve"),Promise:a("./promise")}},{"./defer":81,"./is_promise":83,"./promise":84,"./reject":85,"./reject_with":86,"./resolve":87,"./resolve_with":88}],83:[function(a,b){b.exports=function(a){return a&&a.then?"function"==typeof a.then:!1}},{}],84:[function(a,b){(function(c){b.exports=function(){return"function"==typeof c.Promise?c.Promise:a("bluebird")}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bluebird:3}],85:[function(a,b){var c=a("./defer");b.exports=function(){var a=c();return a.reject(),a.promise}},{"./defer":81}],86:[function(a,b){var c=a("./defer"),d=a("../../lib/error/error");b.exports=function(a){var b=new d(a),e=c();return e.reject(b),e.promise}},{"../../lib/error/error":59,"./defer":81}],87:[function(a,b){var c=a("./defer");b.exports=function(){var a=c();return a.resolve(),a.promise}},{"./defer":81}],88:[function(a,b){var c=a("./defer");b.exports=function(){var a=c();return a.resolve.apply(a,arguments),a.promise}},{"./defer":81}]},{},[42])(42)});